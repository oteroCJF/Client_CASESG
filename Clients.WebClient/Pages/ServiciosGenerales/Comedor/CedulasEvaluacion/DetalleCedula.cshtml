@page "/comedor/{moduloId}/{submoduloId}/detalle/{inmueble}/{cedula}"
@model Clients.WebClient.Pages.Comedor.CedulasEvaluacion.DetalleModel;
@{
    ViewData["Titulo"] = "Servicio de " + Model.Servicio.Descripcion;
    ViewData["Title"] = "Detalle del Inmueble " + Model.Inmueble.Nombre;
    ViewData["Action"] = "Facturación / Detalle de Facturación";
    var i = 0;
    var ci = 0;
    var cf = 0;
    var ce = 0;
    var lc = 0;
    var sp = 0;
    decimal tdeductivas = Model.Cedula.Penalizacion;
    decimal tpenalizacion = 0;
    //var pDeductivas = Model.Cedula.respuestas.Where(r => r.cuestionario.Tipo.Equals("Deductiva")).Select(c => c.cuestionario.Consecutivo);
    //var pPenalizacion = Model.Cedula.respuestas.Where(r => r.cuestionario.Tipo.Equals("Penalizacion")).Select(c => c.cuestionario.Consecutivo);
}

<div class="row col-lg-12">
    <div class="col-lg-12">
        <a href="/comedor/cedulasEvaluacion/@Model.Modulo.Id/@Model.Submodulo.Id/index?Anio=@Model.Cedula.Anio" type='button' class="btn btn-sm btn-warning float-right ml-2 btnRegresar" data-toggle="tooltip" title="Regresar" data-placement="top">
            <i class="fal fa-arrow-left"></i>
        </a>
        @if (@Model.Cedula.Estatus.Nombre.Equals("Autorizada") || @Model.Cedula.Estatus.Nombre.Equals("Autorizado CAE") ||
        @Model.Cedula.Estatus.Nombre.Equals("Trámite Rechazado") || @Model.Cedula.Estatus.Nombre.Equals("En Trámite") ||
        @Model.Cedula.Estatus.Nombre.Equals("Trámite de Pago"))
        {
            <a href="#" type='button' class="btn btn-sm btn-danger float-right ml-2 solicitudRechazo" data-toggle="tooltip"
               title="Solicitar rechazo de la cédula" data-placement="top">
                <i class="fal fa-times-circle"></i>
            </a>
        }
    </div>
</div>

<div class="row col-lg-12 mt-3">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header cabeceraInformacion">
                <i class="fa-sharp fa-light fa-list-check mr-2"></i> Información
            </div>
            <div class="card-body" id="cuerpoInformacion" style="display:none">
                <div class="row col-lg-12">
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header cabeceraInformacionG">
                                <i class="fa-sharp fa-light fa-list-check mr-2"></i> General
                            </div>
                            <div class="card-body" id="cuerpoInformacionG" style="display: none">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <ul class="mb-0 fa-ul">
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-calendar"></i></span>Evaluación correspondiente al mes de <b>@Model.Cedula.Mes.Nombre</b> del año <b>@Model.Cedula.Anio</b></li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-check"></i></span><b class="mr-1 @Model.Cedula.Estatus.Fondo.Replace("bg","text")">Estatus: @Model.Cedula.Estatus.Nombre</b></li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-dollar-sign"></i></span> <b>Facturación Total: </b>: @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", Model.Facturas.Sum(f => f.Total))</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fad fa-star"></i></span> <b>Calificación: </b> @Model.Cedula.Calificacion</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-user"></i></span> <b>Elaboró: </b> @Model.Cedula.Usuario.NombreEmp @Model.Cedula.Usuario.PaternoEmp @Model.Cedula.Usuario.MaternoEmp</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-mailbox"></i></span> <b>Correo: </b> @Model.Cedula.Usuario.Email</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header cabeceraContrato">
                                <i class="fa-sharp fa-light fa-file-contract mr-2"></i> Contrato
                            </div>
                            <div class="card-body" id="cuerpoContrato" style="display: none">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <ul class="ml-4 mb-0 fa-ul">
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-info"></i></span> <b># de Contrato: </b> @Model.Cedula.Contrato.NoContrato</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fad fa-calendar"></i></span> <b>Vigencia: </b> Del @Model.Cedula.Contrato.InicioVigencia.ToString("dd/MM/yyyy") al @Model.Cedula.Contrato.FinVigencia.ToString("dd/MM/yyyy")</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-building-user"></i></span> <b>Empresa: </b> @Model.Cedula.Contrato.Empresa <br /></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header cabeceraInmueble">
                                <i class="fa-sharp fa-light fa-building mr-2"></i> Inmueble
                            </div>
                            <div class="card-body" id="cuerpoInmueble" style="display: none">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <ul class="mb-0 fa-ul">
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span><b>Número de Cliente:</b> @Model.Cedula.Inmueble.ClienteEstafeta</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-building-circle-check"></i></span><b>Inmueble:</b> @Model.Cedula.Inmueble.Nombre</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-building-user"></i></span><b>Administración:</b> @Model.Cedula.Inmueble.Descripcion</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-address-card"></i></span><b>Dirección:</b> @Model.Cedula.Inmueble.Direccion</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-user"></i></span><b>Administrador:</b> @Model.Cedula.Inmueble.Administrador</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row col-lg-12 mt-3" id="divFacturacion">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header cabeceraFacturacion">
                <i class="fa-sharp fa-light fa-money-bill-1-wave mr-2"></i> Facturación
            </div>
            <div class="card-body cuerpoFacturacion" style="display: none">
                <div class="row col-lg-12 mt-3">
                    <h5> Factura(s) y/o Nota(s) de Crédito</h5>
                    <div class="col-lg-12 mt-3 ml-2">
                        <table class="table tblIncidencias tablaFacturas" width="100%">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Estatus</th>
                                    <th>Tipo</th>
                                    <th>Empresa</th>
                                    <th>Folio Fiscal</th>
                                    <th>Número</th>
                                    <th>Subtotal</th>
                                    <th>IVA</th>
                                    <th>Total</th>
                                    <th>Fecha de Carga</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="AA">
                                @foreach (var fac in Model.Facturas)
                                {
                                    i++;
                                    <tr>
                                        <td>@i</td>
                                        <td class="@fac.Estatus.Fondo.Replace("bg","text") font-weight-bold">@fac.Estatus.Nombre</td>
                                        <td>@(fac.Tipo.Equals("NC") ? "Nota de Crédito" : "Factura")</td>
                                        <td>@fac.Nombre</td>
                                        <td>
                                            @fac.UUID
                                        </td>
                                        <td>@fac.Folio</td>
                                        <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", fac.Subtotal)</td>
                                        <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", fac.IVA)</td>
                                        <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", fac.Total)</td>
                                        <td>@fac.FechaCreacion.ToString("dd/MMMM/yyyy")</td>
                                        <td class="text-center">
                                            <a href="#" class="viewConceptosF" id="viewConceptos_@fac.Id" data-factura="@fac.Id" data-toggle="tooltip" title="Mostrar/Ocultar el detalle de la factura" data-placement="top">
                                                <i class="fas fa-eye text-success mr-2"></i>
                                            </a>
                                            <a href="javascript:" class="verFactura" data-tipo="@fac.Tipo" data-archivo="@fac.ArchivoPDF"
                                               data-folio="@(fac.Serie + fac.Folio)" data-subtotal="@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", fac.Subtotal)"
                                               data-total="@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", fac.Total)"
                                               data-iva="@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", fac.IVA)"
                                               data-toggle="tooltip" title="Ver y descargar el PDF" data-placement="top">
                                                <i class='fa-solid fa-file-pdf text-danger'></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="col-lg-12 mt-3 ml-2 mb-3">
                        @foreach (var fac in Model.Facturas)
                        {
                            cf = 0;
                            <div class="row col-lg-12">
                                <div class="col-lg-12">
                                    <div class="conceptosFactura" id="conceptoFactura_@fac.Id">
                                        <h3>Conceptos de la @(fac.Tipo.Equals("Factura") ? "Factura" : "Nota de Crédito") con Folio: @fac.Folio</h3>
                                        <table id="@fac.Folio" style="width: 90%" class="table tableConceptos mt-3 float-right">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Cantidad</th>
                                                    <th>Unidad</th>
                                                    <th>Descripción</th>
                                                    <th>Precio Unitario</th>
                                                    <th>SubTotal</th>
                                                    <th>IVA</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var con in fac.ConceptosFactura)
                                                {
                                                    if (@fac.Id == con.FacturaId)
                                                    {
                                                        cf++;
                                                        <tr>
                                                            <td>@cf</td>
                                                            <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:n0}", con.Cantidad)</td>
                                                            <td>@con.Unidad</td>
                                                            <td>@con.Descripcion</td>
                                                            <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", con.PrecioUnitario)</td>
                                                            <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", con.Subtotal)</td>
                                                            <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", con.IVA)</td>
                                                            <td class="text-right">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", con.Subtotal + con.IVA)</td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@if (Model.Cedula.Id != 0)
{
    <div class="row col-lg-12 mt-3" id="divCedula">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header cabeceraCedula">
                    <i class="fa-regular fa-clipboard-question mr-2"></i> Cédula de Evaluación
                </div>
                <div class="card-body cuerpoCedula">
                    <table class="table table-borderless">
                        <tr>
                            <td data-toggle="tooltip" title="Folio de evaluación asignado por el sistema" data-placement="top" style="font-family: Tahoma; font-size: 13.5px; letter-spacing: 0.8px;"><strong>Folio: </strong> @Model.Cedula.Folio</td>
                            <td data-toggle="tooltip" title="Año de evaluación del servicio" data-placement="top"><strong>Año: </strong>@Model.Cedula.Anio</td>
                            <td data-toggle="tooltip" title="Mes evaluado" data-placement="top"><strong>Mes: </strong>@Model.Cedula.Mes.Nombre</td>
                            <td data-toggle="tooltip" title="Administración/Inmueble evaluado" data-placement="top"><strong>Inmueble: </strong>@Model.Cedula.Inmueble.Nombre</td>
                            @if (Model.Cedula.Servicio != null && !Model.Cedula.Servicio.Equals(""))
                            {
                                <td data-toggle="tooltip" title="Administración/Inmueble evaluado" data-placement="top"><strong>Tipo de Servicio: </strong>@Model.Cedula.Servicio.Nombre</td>
                            }
                            <td data-toggle="tooltip" title="Estatus de la cédula" data-placement="top">
                                <strong style="color: @(Model.Cedula.Estatus.FondoHexadecimal)"><b class="mr-1">Estatus:</b> @Html.Raw(Model.Cedula.Estatus.Icono) @Model.Cedula.Estatus.Nombre</strong>
                            </td>
                        </tr>
                    </table>
                    @foreach (var ct in Model.Cedula.Cuestionario)
                    {
                        <div class="row col-lg-12 mt-3 categoria" id="div_@ct.Abreviacion">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-header cabeceraCedula">
                                        <i class="fas fa-list-check mr-2"></i> @ct.Nombre
                                    </div>
                                    <div class="card-body">
                                        <div class="row col-lg-12 mt-3">
                                            <div class="col-md-12">
                                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                                    @foreach (var rs in ct.Respuestas)
                                                    {
                                                        <li class="nav-item" role="presentation">
                                                            <a class="nav-link" id="pregunta_@rs.cuestionario.Abreviacion" data-toggle="tab" href="#@rs.cuestionario.Abreviacion" role="tab" aria-controls="pregunta" aria-selected="false">
                                                                @if (rs.Respuesta != null)
                                                                {
                                                                    <i class="fas fa-circle-check mr-2 text-success"></i> @Html.Raw("<b style='color: black;'>Pregunta " + @rs.Pregunta + "</b>")
                                                                }
                                                                else
                                                                {
                                                                    <i class="fas fa-circle-xmark mr-2 text-danger"></i> @Html.Raw("<b style='color: black;'>Pregunta " + @rs.Pregunta + "</b>")
                                                                }
                                                            </a>
                                                        </li>
                                                    }
                                                </ul>
                                                <div class="tab-content" id="myTabContent">
                                                    @foreach (var rs in ct.Respuestas)
                                                    {
                                                        <div class="tab-pane fade mt-2 ml-3 " id="@rs.cuestionario.Abreviacion" role="tabpanel" aria-labelledby="pregunta-tab">
                                                            <div class="row col-lg-12 h5 mt-3">
                                                                <div class="col-lg-10">
                                                                    @rs.Pregunta.- @rs.cuestionario.Pregunta
                                                                    <a href="javascript:" class="text-primary ml-2 btnAyuda" data-toggle="tooltip" title="Ayuda" data-placement="top" data-ayuda="@rs.cuestionario.Ayuda">
                                                                        <i class="fa-solid fa-circle-question"></i>
                                                                    </a>
                                                                    @if (Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("actualizar")).Count() != 0)
                                                                    {
                                                                        @if (Model.Cedula.Estatus.Nombre.Equals("Rechazada") || Model.Cedula.Estatus.Nombre.Equals("En Proceso") ||
                                                                       Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                                                                        {
                                                                            <div class="row col-lg-6 mt-2" style="display: @(rs.cuestionario.Abreviacion.Equals("Cierre") || rs.cuestionario.Abreviacion.Equals("FechaCierre") ? "none": "block");">
                                                                                <div class="icheck-success d-inline">
                                                                                    <input type="radio" name="@rs.cuestionario.Abreviacion" value="true" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@rs.cuestionario.NoPregunta"
                                                                                           data-pusuario="@rs.cuestionario.Consecutivo"
                                                                                           data-obligatorio="@rs.ciComedor.Obligatorio"
                                                                                           data-respuesta="@rs.ciComedor.Respuesta"
                                                                                           data-abreviacion="@rs.cuestionario.Abreviacion">
                                                                                    <label for="@String.Concat("radioSuccess", @i)">Si</label>
                                                                                </div>
                                                                                @{
                                                                                    i++;
                                                                                }
                                                                                <div class="icheck-success d-inline ml-3">
                                                                                    <input type="radio" name="@rs.cuestionario.Abreviacion" value="false" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@rs.cuestionario.NoPregunta"
                                                                                           data-pusuario="@rs.cuestionario.Consecutivo"
                                                                                           data-obligatorio="@rs.ciComedor.Obligatorio"
                                                                                           data-respuesta="@rs.ciComedor.Respuesta"
                                                                                           data-abreviacion="@rs.cuestionario.Abreviacion">
                                                                                    <label for="@String.Concat("radioSuccess", @i)">No</label>
                                                                                </div>
                                                                                @{
                                                                                    i++;
                                                                                }

                                                                                @if (@rs.cuestionario.NoAplica)
                                                                                {
                                                                                    <div class="icheck-success d-inline ml-3">
                                                                                        <input type="radio" name="@rs.cuestionario.Abreviacion" value="N/A" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@rs.cuestionario.NoPregunta"
                                                                                               data-pusuario="@rs.cuestionario.Consecutivo"
                                                                                               data-obligatorio="@rs.ciComedor.Obligatorio"
                                                                                               data-respuesta="@rs.ciComedor.Respuesta"
                                                                                               data-abreviacion="@rs.cuestionario.Abreviacion">
                                                                                        <label for="@String.Concat("radioSuccess", @i)">No aplica</label>
                                                                                    </div>
                                                                                    i++;
                                                                                }

                                                                                @if (@rs.cuestionario.NoEntrego)
                                                                                {
                                                                                    <div class="icheck-success d-inline ml-3">
                                                                                        <input type="radio" name="@rs.cuestionario.Abreviacion" value="N/E" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@rs.cuestionario.NoPregunta"
                                                                                               data-pusuario="@rs.cuestionario.Consecutivo"
                                                                                               data-obligatorio="@rs.ciComedor.Obligatorio"
                                                                                               data-respuesta="@rs.ciComedor.Respuesta"
                                                                                               data-abreviacion="@rs.cuestionario.Abreviacion">
                                                                                        <label for="@String.Concat("radioSuccess", @i)">No entregó</label>
                                                                                    </div>
                                                                                    i++;
                                                                                }

                                                                                @if (@rs.cuestionario.NoRealizo)
                                                                                {
                                                                                    <div class="icheck-success d-inline ml-3">
                                                                                        <input type="radio" name="@rs.cuestionario.Abreviacion" value="N/R" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@rs.cuestionario.NoPregunta"
                                                                                               data-pusuario="@rs.cuestionario.Consecutivo"
                                                                                               data-obligatorio="@rs.ciComedor.Obligatorio"
                                                                                               data-respuesta="@rs.ciComedor.Respuesta"
                                                                                               data-abreviacion="@rs.cuestionario.Abreviacion">
                                                                                        <label for="@String.Concat("radioSuccess", @i)">No realizó</label>
                                                                                    </div>
                                                                                    i++;
                                                                                }
                                                                            </div>
                                                                        }
                                                                    }
                                                                </div>
                                                                <div class="col-lg-12 mt-2">
                                                                    @if (Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("actualizar")).Count() != 0)
                                                                    {
                                                                        @if (Model.Cedula.Estatus.Nombre.Equals("Rechazada") || Model.Cedula.Estatus.Nombre.Equals("En Proceso") || Model.Cedula.Estatus.Nombre.Equals("Bloqueada") ||
                                                                       Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                                                                        {
                                                                            @if (rs.cuestionario.Incidencias && (rs.cuestionario.Abreviacion.Equals("Cierre") || rs.cuestionario.Abreviacion.Equals("FechaCierre")))
                                                                            {
                                                                                if (rs.iComedor.Count() == 0)
                                                                                {
                                                                                    <a href="javascript:" class="addIncidencia btn btn-sm btn-primary" data-pregunta="@rs.cuestionario.Consecutivo"
                                                                                       data-preguntaid="@rs.cuestionario.Id"
                                                                                       data-cedula="@rs.CedulaEvaluacionId"
                                                                                       data-abreviacion="@rs.cuestionario.Abreviacion"
                                                                                       data-titulo="@Model.CTIncidencias.Single(i => i.Abreviacion.Equals(rs.cuestionario.Abreviacion)).Valor"
                                                                                       data-respuesta="@rs.Respuesta"
                                                                                       data-ayuda="@rs.ciComedor.Ayuda"
                                                                                       data-incidenciaid="@Model.CTIncidencias.Single(i => i.Abreviacion.Equals(rs.cuestionario.Abreviacion)).Id"
                                                                                       data-toggle="tooltip" title="Agregar nueva incidencia" data-placement="top">
                                                                                        <i class="fas fa-plus mr-1"></i> @(rs.cuestionario.Abreviacion.Contains("Cierre") ? "Registrar Fecha de Cierre" : "Registrar")
                                                                                    </a>
                                                                                }
                                                                            }
                                                                            else if (rs.cuestionario.Incidencias && rs.ciComedor.Obligatorio && (!rs.Detalles.Equals("N/A") && !rs.Detalles.Equals("N/E") && !rs.Detalles.Equals("N/R"))
                                                                            && (!rs.cuestionario.Abreviacion.Contains("FechaCierre") || !rs.cuestionario.Abreviacion.Contains("Cierre")))
                                                                            {
                                                                                <a href="javascript:" class="addIncidencia btn btn-sm btn-primary" data-pregunta="@rs.cuestionario.Consecutivo"
                                                                                   data-preguntaid="@rs.cuestionario.Id"
                                                                                   data-cedula="@rs.CedulaEvaluacionId"
                                                                                   data-abreviacion="@rs.cuestionario.Abreviacion"
                                                                                   data-titulo="@Model.CTIncidencias.Single(i => i.Abreviacion.Equals(rs.cuestionario.Abreviacion)).Valor"
                                                                                   data-respuesta="@rs.Respuesta"
                                                                                   data-ayuda="@rs.ciComedor.Ayuda"
                                                                                   data-incidenciaid="@Model.CTIncidencias.Single(i => i.Abreviacion.Equals(rs.cuestionario.Abreviacion)).Id"
                                                                                   data-toggle="tooltip" title="Agregar nueva incidencia" data-placement="top">
                                                                                    <i class="fas fa-plus mr-1"></i> Registrar Incidencia
                                                                                </a>
                                                                            }
                                                                        }
                                                                    }
                                                                </div>
                                                            </div>
                                                            @if (rs.cuestionario.Incidencias && rs.iComedor.Count() != 0)
                                                            {
                                                                ci = 0;
                                                                <div class="row mt-3">
                                                                    <div class="col-lg-12">
                                                                        <table class="table tblIncidencias" width="100%">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>#</th>
                                                                                    <th>Tipo</th>
                                                                                    @if (@rs.ciComedor.Ponderacion)
                                                                                    {
                                                                                        <th>Perfil</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaIncidencia)
                                                                                    {
                                                                                        if (!rs.cuestionario.Abreviacion.Equals("Cierre") && !rs.cuestionario.Abreviacion.Equals("FechaCierre"))
                                                                                        {
                                                                                            <th>Fecha incidencia</th>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <th>Fecha</th>
                                                                                        }
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaProgramada)
                                                                                    {
                                                                                        <th>Fecha programada</th>
                                                                                    }
                                                                                    @if (@rs.ciComedor.UltimoDia)
                                                                                    {
                                                                                        <th>Último día</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaRealizada)
                                                                                    {
                                                                                        <th>Fecha realizada</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaInventario)
                                                                                    {
                                                                                        <th>Fecha inventario</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaNotificacion)
                                                                                    {
                                                                                        <th>Fecha notificacion</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaAcordadaAdmin)
                                                                                    {
                                                                                        <th>Fecha acordada con la Administración</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.FechaEntrega)
                                                                                    {
                                                                                        <th>Fecha de entrega</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.HoraInicio)
                                                                                    {
                                                                                        <th>Hora de inicio</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.HoraReal)
                                                                                    {
                                                                                        <th>Hora real</th>
                                                                                    }

                                                                                    @if (@rs.ciComedor.Cantidad)
                                                                                    {
                                                                                        @if (@rs.cuestionario.Tipo.Equals("Penalizacion"))
                                                                                        {
                                                                                            <th>Días de atraso</th>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <th>Cantidad</th>
                                                                                        }
                                                                                    }

                                                                                    @if (@rs.ciComedor.Observaciones)
                                                                                    {
                                                                                        @if (rs.ciComedor.MateriaPrima || rs.ciComedor.Abasto)
                                                                                        {
                                                                                            <th>Detalle de la Incidencia</th>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <th>Observaciones</th>
                                                                                        }
                                                                                    }

                                                                                    @if (!Model.Cedula.Estatus.Nombre.Equals("Rechazada") && !Model.Cedula.Estatus.Nombre.Equals("En Proceso") &&
                                                                                   !Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar") && (!rs.cuestionario.Abreviacion.Equals("Cierre") && !rs.cuestionario.Abreviacion.Equals("FechaCierre")))
                                                                                    {
                                                                                        <th>Monto Penalizacion</th>
                                                                                    }

                                                                                    @if (Model.Cedula.Estatus.Nombre.Equals("Rechazada") || Model.Cedula.Estatus.Nombre.Equals("En Proceso") ||
                                                                                   Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                                                                                    {
                                                                                        <th>Acciones</th>
                                                                                    }
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                @foreach (var inc in rs.iComedor)
                                                                                {
                                                                                    ci++;
                                                                                    <tr>
                                                                                        <td>@ci</td>
                                                                                        <td>@inc.Incidencia.Valor</td>
                                                                                        @if (@inc.ciComedor.Ponderacion)
                                                                                        {
                                                                                            <td>@inc.Perfil.Nombre</td>
                                                                                        }
                                                                                        @if (@rs.ciComedor.FechaIncidencia)
                                                                                        {
                                                                                            <td>@inc.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaProgramada)
                                                                                        {
                                                                                            <td>@inc.FechaProgramada.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.UltimoDia)
                                                                                        {
                                                                                            <td>@inc.UltimoDia.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaRealizada)
                                                                                        {
                                                                                            <td>@inc.FechaRealizada.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaInventario)
                                                                                        {
                                                                                            <td>@inc.FechaInventario.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaNotificacion)
                                                                                        {
                                                                                            <td>@inc.FechaNotificacion.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaAcordadaAdmin)
                                                                                        {
                                                                                            <td>@inc.FechaAcordadaAdmin.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaEntrega)
                                                                                        {
                                                                                            <td>@inc.FechaEntrega.ToString("dd/MM/yyyy")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.HoraInicio)
                                                                                        {
                                                                                            <td>@Convert.ToDateTime(inc.HoraInicio).ToString("hh:mm tt")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.HoraReal)
                                                                                        {
                                                                                            <td>@Convert.ToDateTime(inc.HoraReal).ToString("hh:mm tt")</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.Cantidad)
                                                                                        {
                                                                                            <td>@inc.Cantidad</td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.Observaciones)
                                                                                        {
                                                                                            @if (inc.ciComedor.MateriaPrima || inc.ciComedor.Abasto)
                                                                                            {
                                                                                                <td>
                                                                                                    <b>Observaciones: </b>@inc.Observaciones
                                                                                                    <table class="table dtlIncidencias" width="100%">
                                                                                                        <thead>
                                                                                                            <tr>
                                                                                                                <th>#</th>
                                                                                                                <th>Tipo</th>
                                                                                                                <th>Concepto</th>
                                                                                                                @if (!Model.Cedula.Estatus.Nombre.Equals("Rechazada") && !Model.Cedula.Estatus.Nombre.Equals("En Proceso") &&
                                                                                                               !Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                                                                                                                {
                                                                                                                    <th>Monto de Penalización</th>
                                                                                                                }
                                                                                                            </tr>
                                                                                                        </thead>
                                                                                                        <tbody>
                                                                                                            @{
                                                                                                                int cti = 0;
                                                                                                            }
                                                                                                            @foreach (var dtic in inc.DIncidencias)
                                                                                                            {
                                                                                                                cti++;
                                                                                                                <tr>
                                                                                                                    <td>@cti</td>
                                                                                                                    <td>@dtic.DIncidencia.Tipo.Nombre</td>
                                                                                                                    <td>@dtic.DIncidencia.Nombre</td>
                                                                                                                    @if (!Model.Cedula.Estatus.Nombre.Equals("Rechazada") && !Model.Cedula.Estatus.Nombre.Equals("En Proceso") &&
                                                                                                                   !Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                                                                                                                    {
                                                                                                                        <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", @dtic.MontoPenalizacion)</td>
                                                                                                                    }
                                                                                                                </tr>
                                                                                                            }
                                                                                                        </tbody>
                                                                                                    </table>
                                                                                                </td>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <td>@inc.Observaciones</td>
                                                                                            }
                                                                                        }

                                                                                        @if (!Model.Cedula.Estatus.Nombre.Equals("Rechazada") && !Model.Cedula.Estatus.Nombre.Equals("En Proceso") &&
                                                                                       !Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar") && (!rs.cuestionario.Abreviacion.Equals("Cierre") && !rs.cuestionario.Abreviacion.Equals("FechaCierre")))
                                                                                        {
                                                                                            <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", @inc.MontoPenalizacion)</td>
                                                                                        }

                                                                                        @if (Model.Cedula.Estatus.Nombre.Equals("Rechazada") || Model.Cedula.Estatus.Nombre.Equals("En Proceso") ||
                                                                                       Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                                                                                        {
                                                                                            <td>
                                                                                                <a href="javascript:" class="editIncidencia" data-pregunta="@rs.cuestionario.Consecutivo"
                                                                                                   data-abreviacion="@rs.cuestionario.Abreviacion" data-incidencia="@inc.Id"
                                                                                                   data-titulo="@Model.CTIncidencias.Single(i => i.Abreviacion.Equals(rs.cuestionario.Abreviacion)).Valor"
                                                                                                   data-incidenciaid="@inc.IncidenciaId" data-preguntaid="@rs.cuestionario.Id"
                                                                                                   data-perfil="@inc.Ponderacion">
                                                                                                    <i class="fas fa-pencil text-primary"></i>
                                                                                                </a>
                                                                                                <a href="javascript:" class="eliminarIncidencia ml-2"
                                                                                                   data-titulo="@Model.CTIncidencias.Single(i => i.Abreviacion.Equals(rs.cuestionario.Abreviacion)).Valor"
                                                                                                   data-id="@inc.Id">
                                                                                                    <i class="fas fa-times text-danger"></i>
                                                                                                </a>
                                                                                            </td>
                                                                                        }
                                                                                    </tr>
                                                                                }
                                                                            </tbody>
                                                                            @if (!Model.Cedula.Estatus.Nombre.Equals("Rechazada") && !Model.Cedula.Estatus.Nombre.Equals("En Proceso") &&
                                                                           !Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar") && (!rs.cuestionario.Abreviacion.Equals("Cierre") && !rs.cuestionario.Abreviacion.Equals("FechaCierre")))
                                                                            {
                                                                                <tfoot>
                                                                                    <tr>
                                                                                        <td><b>Total:</b></td>
                                                                                        <td></td>
                                                                                        @if (@rs.ciComedor.Ponderacion)
                                                                                        {
                                                                                            <td></td>
                                                                                        }
                                                                                        @if (@rs.ciComedor.FechaIncidencia)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaProgramada)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.UltimoDia)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaRealizada)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaInventario)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaNotificacion)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaAcordadaAdmin)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.FechaEntrega)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.HoraInicio)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.HoraReal)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.Cantidad)
                                                                                        {
                                                                                            <td></td>
                                                                                        }

                                                                                        @if (@rs.ciComedor.Observaciones)
                                                                                        {
                                                                                            <td></td>
                                                                                        }
                                                                                        <td><b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", rs.iComedor.Sum(i => i.MontoPenalizacion))</b></td>
                                                                                    </tr>
                                                                                </tfoot>
                                                                            }
                                                                        </table>
                                                                    </div>
                                                                </div>

                                                            }
                                                            else if (rs.cuestionario.Incidencias && rs.iComedor.Count() == 0)
                                                            {
                                                                ci = 0;
                                                                <div class="row col-lg-12 mt-3">
                                                                    <table class="table">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>#</th>
                                                                                <th>Respuesta</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td>1</td>
                                                                                <td>@(rs.Detalles.Equals("N/A") ? "La captura de incidencias no aplica para esta evaluación." : rs.ciComedor.RespuestaCedula)</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            }
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row col-lg-12 mt-3" id="divEntregables">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header cabeceraEntregables">
                    <i class="fa-sharp fa-light fa-paperclip mr-2"></i> Entregables
                </div>
                <div class="card-body cuerpoEntregables" style="display: none">
                    <table class="table row-border dataTable" width="100%">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Entregable</th>
                                <th>Usuario</th>
                                <th>Archivo</th>
                                <th>Estatus</th>
                                <th>Última actualización</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var en in Model.Cedula.entregables)
                            {
                                var fe = Model.FlujoEntregables.SingleOrDefault(fe => fe.EntregableId == en.EntregableId && fe.Flujo.Equals(Model.Supervision)
                                && fe.EstatusId == Model.Cedula.EstatusId);
                                ce++;
                                <tr>
                                    <td>@ce</td>
                                    <td>@en.tipoEntregable.Nombre</td>
                                    <td>@(System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToTitleCase((en.usuario.NombreEmp + " " + en.usuario.PaternoEmp + " " + en.usuario.MaternoEmp).ToLower()))</td>
                                    <td class="font-weight-bold @(en.Archivo != null && !en.Archivo.Equals("") ? "text-success" : "text-danger")">@(en.Archivo != null && !en.Archivo.Equals("") ? en.Archivo : "Sin Adjuntar")</td>
                                    <td style="color: @en.estatus.FondoHexadecimal; font-weight: bold;">
                                        @Html.Raw(en.estatus.Nombre + " ")
                                    </td>
                                    <td>@(Convert.ToDateTime(en.FechaActualizacion).ToString("dd/MM/yyyy").Equals("01/01/0001") ? "-" : Convert.ToDateTime(en.FechaActualizacion).ToString("dd/MM/yyyy HH:mm tt"))</td>
                                    <td>
                                        @if (en.Archivo != null && !en.Archivo.Equals(""))
                                        {
                                            <a class="verEntregable" href="javascript:" data-toggle="tooltip" title="Ver @en.tipoEntregable.Nombre"
                                               data-placement="top" data-tipo="@en.tipoEntregable.Nombre" data-id="@en.Id" data-archivo="@en.Archivo"
                                               data-observaciones="@en.Observaciones">
                                                <i class="fas fa-eye text-success mr-2"></i>
                                            </a>
                                        }

                                        @if (Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("editarEntregable")).Count() != 0 &&
                                       (fe != null ? fe.Editable : false) && !en.estatus.Nombre.Equals("Autorizado"))
                                        {
                                            <a class="editarEntregable" href="javascript:" data-toggle="tooltip" title="Cargar @en.tipoEntregable.Nombre"
                                               data-placement="top" data-tipo="@en.tipoEntregable.Nombre" data-id="@en.Id"
                                               data-entregableid="@en.EntregableId" data-file="@en.Archivo">
                                                <i class="fas fa-pencil text-primary mr-2"></i>
                                            </a>
                                        }

                                        @if (Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("autorizarEntregable")).Count() != 0 &&
                                       (fe != null ? fe.Autorizar : false) && !en.estatus.Nombre.Equals("Autorizado"))
                                        {
                                            <a class="autorizarEntregable" href="javascript:" data-toggle="tooltip" title="Autorizar @en.tipoEntregable.Nombre"
                                               data-placement="top" data-tipo="@en.tipoEntregable.Nombre" data-id="@en.Id" data-entregableid="@en.EntregableId">
                                                <i class="fas fa-check text-success mr-2"></i>
                                            </a>
                                        }

                                        @if (Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("rechazarEntregable")).Count() != 0 && (fe != null ? fe.Rechazar : false)
                                       && !en.estatus.Nombre.Equals("Rechazado"))
                                        {
                                            <a class="rechazarEntregable" href="javascript:" data-toggle="tooltip" title="Rechazar @en.tipoEntregable.Nombre"
                                               data-placement="top" data-tipo="@en.tipoEntregable.Nombre" data-id="@en.Id" data-entregableid="@en.EntregableId">
                                                <i class="fas fa-times text-danger"></i>
                                            </a>
                                        }

                                        @if (en.tipoEntregable.Abreviacion.Equals("ActaER") && !en.estatus.Nombre.Equals("Autorizado") &&
                                       (Model.Cedula.Estatus.Nombre.Equals("Autorizada") || Model.Cedula.Estatus.Nombre.Equals("Trámite Rechazado")))
                                        {
                                            <a href="javascript:" class="generaAER">
                                                <i class="fa-sharp fa-regular fa-file-word"></i>
                                            </a>
                                        }

                                        @if (en.tipoEntregable.Abreviacion.Equals("Cedula_Firmada") && !en.estatus.Nombre.Equals("Autorizado") &&
                                       (Model.Cedula.Estatus.Nombre.Equals("Enviada a DAS") || Model.Cedula.Estatus.Nombre.Equals("Autorizada") || Model.Cedula.Estatus.Nombre.Equals("Trámite Rechazado")))
                                        {
                                            <a class="generarCedula" href="javascript:" data-toggle="tooltip" title="Generar la Cédula de Evaluación"
                                               data-placement="top" data-tipo="@en.tipoEntregable.Nombre" data-id="@en.Id">
                                                <i class="fal fa-file-pdf text-success mr-2"></i>
                                            </a>
                                        }

                                        @if ((fe != null ? fe.Validar : false) &&
                                       en.estatus.Nombre.Equals("Autorizado") && !en.Validado)
                                        {
                                            <a class="validarEntregable" href="javascript:" data-toggle="tooltip" title="Validar @en.tipoEntregable.Nombre"
                                               data-placement="top" data-tipo="@en.tipoEntregable.Nombre" data-id="@en.Id" data-estatusid="@en.EstatusId"
                                               data-entregableid="@en.EntregableId">
                                                <i class="fa-regular fa-check-double text-primary ml-2"></i>
                                            </a>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="card-footer">
                    @if (Model.Cedula.Estatus.Nombre.Equals("Rechazada") || Model.Cedula.Estatus.Nombre.Equals("En Proceso") ||
                   Model.Cedula.Estatus.Nombre.Equals("Sin Iniciar"))
                    {
                        <a href="javascript:" class="btn btn-sm btn-primary guardarCedula float-right">
                            Guardar Respuestas
                        </a>
                        @foreach (var bt in Model.Flujo)
                        {
                            if (bt.EstatusId == Model.Cedula.EstatusId && Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals(bt.ESucesivo.Abreviacion)).Count() > 0)
                            {
                                @Html.Raw(bt.Boton)
                            }
                        }
                    }
                    else
                    {
                        @foreach (var bt in Model.Flujo)
                        {
                            if (bt.EstatusId == Model.Cedula.EstatusId && Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals(bt.ESucesivo.Abreviacion)).Count() > 0)
                            {
                                @Html.Raw(bt.Boton)
                            }
                        }
                    }

                    @if (Model.Cedula.Bloqueada && Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("denegar")).Count() > 0)
                    {
                        <a href="javascript:" class="btn btn-sm bg-correccion denegarRechazo float-right mr-2"
                           data-estatus="Denegar el rechazo de la cédula">
                            Denegar Rechazo
                        </a>
                    }

                    @if (Model.Cedula.Bloqueada && Model.Permisos.Where(p => p.Permiso.Abreviacion.Equals("cancelar")).Count() > 0)
                    {
                        <a href="javascript:" class="btn btn-sm bg-danger cancelarRechazo float-right mr-2"
                           data-estatus="Cancelar el rechazo de la cédula">
                            Cancelar Rechazo
                        </a>
                    }
                </div>
            </div>
        </div>
    </div>

    @if (Model.Cedula.EstatusId > 2)
    {
        <div class="row col-lg-12 mt-3" id="divPenalizaciones">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header cabeceraPenalizaciones">
                        <i class="fa-regular fa-messages-dollar mr-2"></i> Penalizaciones y deductivas
                    </div>
                    <div class="card-body cuerpoPenalizaciones" style="display: none">
                        <p class="text-justify text-primary font-weight-bold h5">Únicamente solicitar al prestador de servicios la nota de crédito por el(los) concepto(s) del total de deductivas, en caso de que aplique.</p>
                        <ul class="mb-0 fa-ul">
                            <li class="medium mt-3"><span class="fa-li"><i class="fas fa-lg fa-calendar"></i></span>Evaluación correspondiente al mes de <b>@Model.Cedula.Mes.Nombre</b> del año <b>@Model.Cedula.Anio</b></li>
                            <li class="medium mt-3"><span class="fa-li"><i class="fas fa-lg fa-building-circle-check"></i></span><b>Inmueble:</b> @Model.Inmueble.Nombre</li>
                        </ul>
                        <h5 class="mt-3">Deductivas</h5>
                        <table class="table row-border dataTable" width="100%">
                            <thead>
                                <tr>
                                    <th class="text-center">Pregunta</th>
                                    <th>Tipo</th>
                                    <th>Concepto</th>
                                    <th class="text-right">Monto</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var ct in Model.Cedula.Cuestionario)
                                {
                                    @foreach (var rs in ct.Respuestas)
                                    {
                                        if (rs.MontoPenalizacion != 0 && rs.cuestionario.Tipo.Equals("Deductiva"))
                                        {
                                            <tr>
                                                <td class="text-center">@rs.Pregunta</td>
                                                <td>Deductiva</td>
                                                <td>@Html.Raw(rs.cuestionario.Icono) @rs.cuestionario.Concepto</td>
                                                <td class="text-right text-primary font-weight-bold">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", @rs.MontoPenalizacion)</td>
                                            </tr>
                                            tdeductivas += rs.cuestionario.Tipo.Equals("Deductiva") ? (decimal)rs.MontoPenalizacion : (decimal)0;
                                        }
                                    }
                                }

                                @if (Model.Cedula.Penalizacion != 0)
                                {
                                    <tr>
                                        <td class="text-center">-</td>
                                        <td>Deductiva</td>
                                        <td><i class="fa-sharp fa-regular fa-thumbs-up mr-2"></i> Calidad y eficiencia del servicio</td>
                                        <td class="text-right text-primary font-weight-bold">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", Model.Cedula.Penalizacion)</td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                @if (tdeductivas != 0)
                                {
                                    <tr class="font-weight-bold text-primary">
                                        <td class="text-center">Subtototal de deductivas más el I.V.A.</td>
                                        <td class="text-center">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", tdeductivas)</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                }
                            </tfoot>
                        </table>
                        <h5>Penalizaciones</h5>
                        <table class="table row-border dataTable" width="100%">
                            <thead>
                                <tr>
                                    <th class="text-center">Pregunta</th>
                                    <th>Tipo</th>
                                    <th>Concepto</th>
                                    <th class="text-right">Monto</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var ct in Model.Cedula.Cuestionario)
                                {
                                    @foreach (var rs in ct.Respuestas)
                                    {
                                        if (rs.MontoPenalizacion != 0 && rs.cuestionario.Tipo.Equals("Penalizacion"))
                                        {
                                            <tr>
                                                <td class="text-center">@rs.Pregunta</td>
                                                <td>Penalización</td>
                                                <td>@Html.Raw(rs.cuestionario.Icono) @rs.cuestionario.Concepto</td>
                                                <td class="text-right text-danger font-weight-bold">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", @rs.MontoPenalizacion)</td>
                                            </tr>
                                            tpenalizacion += rs.cuestionario.Tipo.Equals("Penalizacion") ? (decimal)rs.MontoPenalizacion : (decimal)0;
                                        }
                                    }
                                }
                            </tbody>
                            <tfoot>
                                @if (tpenalizacion != 0)
                                {
                                    <tr class="font-weight-bold text-danger">
                                        <td class="text-center">Subtototal de penalizaciones más el I.V.A.</td>
                                        <td class="text-center">@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C4}", tpenalizacion)</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                }
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="row col-lg-12 mt-3" id="divHistorialCedula">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header cabeceraSegCedula">
                    <i class="fal fa-timeline-arrow mr-2"></i> Seguimiento a la cédula
                </div>
                <div class="card-body cuerpoSegCedula" style="display: none">
                    <table class="table dataTable tblLogCedula" width="100%">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Usuario</th>
                                <th>Estatus</th>
                                <th>Comentarios</th>
                                <th>Última actualización</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var lg in Model.Cedula.logs)
                            {
                                lc++;
                                <tr>
                                    <td>@lc</td>
                                    <td>@(System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToTitleCase((lg.Usuario.NombreEmp + " " + lg.Usuario.PaternoEmp + " " + lg.Usuario.MaternoEmp).ToLower()))</td>
                                    <td style="color: @(lg.Estatus.FondoHexadecimal); font-weight: bold;">@lg.Estatus.Nombre</td>
                                    <td>@Html.Raw(lg.Observaciones)</td>
                                    <td>@Convert.ToDateTime(lg.FechaCreacion).ToString("dd/MM/yyyy hh:mm tt")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row col-lg-12 mt-3" id="divHistorialEntregables">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header cabeceraSegEntregables">
                    <i class="fa-light fa-timeline mr-2"></i> Seguimiento a entregables
                </div>
                <div class="card-body cuerpoSegEntregables" style="display: none">
                    <table class="table dataTable tblLogEntregables" width="100%">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Usuario</th>
                                <th>Archivo</th>
                                <th>Estatus</th>
                                <th>Comentarios</th>
                                <th>Última actualización</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                lc = 0;
                            }
                            @foreach (var lg in Model.Cedula.logsEntregables)
                            {
                                lc++;
                                <tr>
                                    <td>@lc</td>
                                    <td>@(System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToTitleCase((lg.Usuario.NombreEmp + " " + lg.Usuario.PaternoEmp + " " + lg.Usuario.MaternoEmp).ToLower()))</td>
                                    <td>@lg.Entregable.Nombre</td>
                                    <td style="color: @(lg.Estatus.FondoHexadecimal); font-weight: bold;">@lg.Estatus.Nombre</td>
                                    <td>@Html.Raw(lg.Observaciones)</td>
                                    <td>@Convert.ToDateTime(lg.FechaCreacion).ToString("dd/MM/yyyy hh:mm tt")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
}

@* Modal para la captura de los entregables *@
<div class="modal fade" id="modalEntregables">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white tituloEntregable"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="campoIdEntregable" />
                <input type="hidden" id="campoTipoEntregable" />
                <input type="hidden" id="campoentregableid" />
                <div class="form-group col-lg-12">
                    <p id="notaEntregable"></p>
                </div>
                <div class="form-group col-lg-8">
                    <label for="elegirArchivo">Seleccionar Archivo PDF: </label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="entregablePDF" accept=".pdf, .PDF">
                        <label class="custom-file-label custom-pdf" for="customFile">Seleccionar Archivo</label>
                    </div>
                    <div class="col-sm-12" id="error_entregablePDF">
                        <small id="dateHelp" class="text-danger">
                            No ha seleccionado el archivo PDF o ha subido un archivo diferente a PDF
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="submit" class="btn btn-primary" id="guardarEntregable">Adjuntar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de los entregables *@

@*Modal para ver los Entregables*@
<div class="modal fade" id="modalVerEntregables">
    <div class="modal-dialog modal-xl-view">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="titleVerEntregables"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body-view">
                <div class="row col-lg-12" id="detalleEntregable"></div>
                <div class="table-responsive">
                    <div class="row mb-2 col-lg-12" id="objectPdf">
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para ver los Entregables*@

@*Modal para ver la factura*@
<div class="modal fade" id="modalVerEntregableFactura">
    <div class="modal-dialog modal-xl-view">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="titleVerEntregables"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body-view">
                <div class="row col-lg-12" id="detalleEntregable"></div>
                <div class="table-responsive">
                    <div class="row mb-2 col-lg-12" id="objectPdf">
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para ver la factura*@

@* Modal para la captura de Incidencias *@
<div class="modal fade" id="modal-incidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Registrar Incidencia</h4>
                <button type="button" class="close close-incidencias text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-row">
                            <input type="hidden" id="campoIdIncidencia" />
                            <input type="hidden" id="campoIncidenciaId" />
                            <input type="hidden" id="campoPregunta" />
                            <input type="hidden" id="campoAbreviacion" />
                            <input type="hidden" id="campoPreguntaId" />
                            <div class="row col-lg-12 mb-3" id="divEntregaEnseres">
                                <div class="form-group col-md-12">
                                    <p class="text-black h6 font-weight-bold">
                                        ¿Cumplió con la entrega de enseres de forma completa?
                                    </p>
                                    <div class="icheck-success d-inline ml-3">
                                        <input type="radio" name="chkEnseres" value="true" id="enseresChk1" class="chkEnseres">
                                        <label for="enseresChk1">Entrega completa después de la fecha pactada</label>
                                    </div>
                                    <div class="icheck-success d-inline ml-3">
                                        <input type="radio" name="chkEnseres" value="false" id="enseresChk2" class="chkEnseres">
                                        <label for="enseresChk2">No entregó</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaIncidencia">
                                <label for="fechaIncidencia">Fecha Incidencia: </label>
                                <input type="date" class="form-control" id="campoFechaIncidencia" name="fechaIncidencia">
                                <div class="col-sm-12" id="error_campoFechaIncidencia">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha incidencia
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaProgramada">
                                <label for="fechaIncidencia">Fecha Programada: </label>
                                <input type="date" class="form-control" id="campoFechaProgramada" name="fechaProgramada">
                                <div class="col-sm-12" id="error_campoFechaProgramada">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha programada
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divUltimoDia">
                                <label for="ultimoDia">Último día: </label>
                                <input type="date" class="form-control" id="campoUltimoDia" name="ultimoDia">
                                <div class="col-sm-12" id="error_campoUltimoDia">
                                    <small id="dateHelp" class="text-danger">
                                        Capture el último día
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaRealizada">
                                <label for="fechaIncidencia">Fecha Realizada: </label>
                                <input type="date" class="form-control" id="campoFechaRealizada" name="fechaRealizada">
                                <div class="col-sm-12" id="error_campoFechaRealizada">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha programada
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaInventario">
                                <label for="fechaInventario">Fecha de Inventario: </label>
                                <input type="date" class="form-control" id="campoFechaInv" name="fechaInventario">
                                <div class="col-sm-12" id="error_campoFechaInv">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha de inventario
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaNotificacion">
                                <label for="fechaNotificacion">Fecha de Notificación: </label>
                                <input type="date" class="form-control" id="campoFechaNotificacion" name="fechaNotificacion">
                                <div class="col-sm-12" id="error_campoFechaNotificacion">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha de notificación
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaAcordadaAdmin">
                                <label for="fechaAcordadaAdmin">Fecha acordada con la Admin: </label>
                                <input type="date" class="form-control" id="campoFechaAcordadaAdmin" name="fechaAcordadaAdmin">
                                <div class="col-sm-12" id="error_campoFechaAcordadaAdmin">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha acordada con la Admin.
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divFechaLimite">
                                <label for="fechaLimite">Fecha Limite: </label>
                                <input type="date" class="form-control" id="campoFechaLimite" name="fechaLimite" disabled>
                            </div>
                            <div class="form-group col-md-3" id="divFechaEntrega">
                                <label for="fechaEntrega">Fecha Entrega: </label>
                                <input type="date" class="form-control" id="campoFechaEntrega" name="fechaEntrega">
                                <div class="col-sm-12" id="error_campoFechaEntrega">
                                    <small id="dateHelp" class="text-danger">
                                        Capture la fecha entrega
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divHoraInicio">
                                <label for="horaSolicitud">Hora Inicio: </label>
                                <input type="time" id="campoHoraInicio" class="form-control">
                                <div class="col-sm-12" id="error_campoHoraInicio">
                                    <small id="dateHelp" class="text-danger">
                                        Por favor capture la hora de inicio
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divHoraReal">
                                <label for="horaReal">Hora Real: </label>
                                <input type="time" id="campoHoraReal" class="form-control">
                                <div class="col-sm-12" id="error_campoHoraReal">
                                    <small id="dateHelp" class="text-danger">
                                        Por favor capture la hora real
                                    </small>
                                </div>
                            </div>
                            <div class="form-group col-md-3" id="divPonderacion">
                                <label>Perfil: </label>
                                <select class="form-control" id="campoPonderacion">
                                    <option value="">Seleccione el perfíl</option>
                                    @foreach (var ctp in Model.Plantilla)
                                    {
                                        <option value="@ctp.Orden">@ctp.Nombre</option>
                                    }
                                </select>
                                <div class="col-sm-12" id="error_campoPonderacion">
                                    <small id="dateHelp" class="text-danger">
                                        Capture el perfil.
                                    </small>
                                </div>
                            </div>
                            <div class="col col-lg-2" id="divCantidad">
                                <label>Cantidad: </label>
                                <div class="col-xs-2 col-xs-offset-3">
                                    <div class="input-group number-spinner">
                                        <span class="input-group-btn">
                                            <button class="btn btn-default" data-dir="dwn"><span class="fas fa-minus"></span></button>
                                        </span>
                                        <input type="number" class="form-control text-center campoCantidad" value="1">
                                        <span class="input-group-btn">
                                            <button class="btn btn-default" data-dir="up"><span class="fas fa-plus"></span></button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row col-lg-12 mb-3" id="divIncidenciasMP">
                                @foreach (var tl in Model.CategoriaIMP)
                                {
                                    <div class="form-group col-md-12">
                                        <h5>@tl.Nombre</h5>
                                        @foreach (var nm in Model.IncidenciasMP)
                                        {
                                            @if (nm.TipoId == tl.Id)
                                            {
                                                <div class="icheck-success d-inline mr-2 mt-2 mb-3">
                                                    <input class="iMateriaPrima" type="checkbox" id="checkboxSuccess_@nm.Id" value="@nm.Id">
                                                    <label for="checkboxSuccess_@nm.Id">@nm.Nombre</label>
                                                </div>
                                            }
                                        }
                                    </div>
                                }
                            </div>
                            <div class="row col-lg-12 mb-3" id="divIncidenciasAbasto">
                                @foreach (var tl in Model.Tiempos)
                                {
                                    <div class="form-group col-md-12">
                                        <h5>@tl.Nombre</h5>
                                        @foreach (var nm in Model.IncidenciasMP)
                                        {
                                            @if (nm.TipoId == tl.Id)
                                            {
                                                <div class="icheck-success d-inline mr-2 mt-2 mb-3">
                                                    <input class="iAbasto" type="checkbox" id="checkboxSuccess_@nm.Id" value="@nm.Id">
                                                    <label for="checkboxSuccess_@nm.Id">@nm.Nombre</label>
                                                </div>
                                            }
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="divObservaciones">
                    <div class="col-lg-12">
                        <div class="form-row col-lg-12">
                            <label for="campoObservaciones">Observaciones:</label>
                            <textarea type="textarea" id="campoObservaciones" class="form-control" style="resize: none;" maxlength="256"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="guardaIncidencia">Guardar Incidencia</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@* Modal para la captura de Incidencias *@

<style>
    .cabeceraInformacion {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraInformacionG {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraContrato {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraInmueble {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraFacturacion {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraCedula {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraEntregables {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraPenalizaciones {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraGuiasNE {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraSegCedula {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    .cabeceraSegEntregables {
        background-color: #ffffff;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    td table tr:first-child td {
        border-top: none !important;
        padding-top: 0 !important;
    }

    .swal-wide {
        width: 800px !important;
    }
</style>

@*Modal para actualizar firmantes*@
<div class="modal fade" id="modal-firmante">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Capturar Firmantes</h4>
                <button type="button" class="close close-incidencias text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input type="hidden" id="idFirmante" />
                    <div class="row col-lg-12 font-weight-bold">
                        <h4>Revisó: </h4>
                        <br />
                    </div>
                    <div class="form-row col-md-4" id="divInmuebleReviso">
                        <label for="firmanteActual">Inmueble:</label>
                        <select class="form-control inmuebleReviso" disabled>
                            <option value="">Seleccione un Inmueble</option>
                            @foreach (var inm in Model.InmueblesFirmantes)
                            {
                                <option value="@inm.Id">@inm.Nombre</option>
                            }
                        </select>
                    </div>
                    <div class="form-row col-md-3" id="divEscolaridadA">
                        <label for="firmanteActual">Escolaridad:</label>
                        <select class="form-control" id="escolaridadReviso">
                            <option value="">Seleccione una escolaridad</option>
                            <option value="C.">Ciudadano</option>
                            <option value="Lic.">Licenciatura</option>
                            <option value="Ing.">Ingeniería</option>
                            <option value="C.P.">Contaduría</option>
                            <option value="Arq.">Arquitectura</option>
                            <option value="Act.">Actuaría</option>
                            <option value="Mtro.">Maestro</option>
                            <option value="Mtra.">Maestra</option>
                            <option value="Dr.">Doctor</option>
                            <option value="Dra.">Doctora</option>
                        </select>
                        <div class="col-sm-12" id="error_escolaridadReviso">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el firmante que revisa.
                            </small>
                        </div>
                    </div>
                    <div class="form-row col-md-4" id="divFirmante">
                        <label for="firmanteActual">Firmante:</label>
                        <select class="form-control" id="firmanteReviso">
                            <option value="">Seleccione un servidor público</option>
                            @foreach (var us in Model.Usuarios)
                            {
                                <option value="@us.Id">@us.NombreEmp @us.PaternoEmp @us.MaternoEmp</option>
                            }
                        </select>
                        <div class="col-sm-12" id="error_firmanteReviso">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione la escolaridad del firmante que revisa.
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="row col-lg-12 font-weight-bold">
                        <h4>Supervisó: </h4>
                        <br />
                    </div>
                    <div class="form-row col-md-4" id="divEscolaridadA">
                        <label for="firmanteActual">Inmueble:</label>
                        <select class="form-control inmuebleSuperviso" disabled>
                            <option value="">Seleccione un Inmueble</option>
                            @foreach (var inm in Model.InmueblesFirmantes)
                            {
                                <option value="@inm.Id">@inm.Nombre</option>
                            }
                        </select>
                    </div>
                    <div class="form-row col-md-3" id="divEscolaridadN">
                        <label for="firmanteActual">Escolaridad:</label>
                        <select class="form-control" id="escolaridadSuperviso">
                            <option value="">Seleccione una escolaridad</option>
                            <option value="C.">Ciudadano</option>
                            <option value="Lic.">Licenciatura</option>
                            <option value="Ing.">Ingeniería</option>
                            <option value="C.P.">Contaduría</option>
                            <option value="Arq.">Arquitectura</option>
                            <option value="Act.">Actuaría</option>
                            <option value="Mtro.">Maestro</option>
                            <option value="Mtra.">Maestra</option>
                            <option value="Dr.">Doctor</option>
                            <option value="Dra.">Doctora</option>
                        </select>
                        <div class="col-sm-12" id="error_escolaridadSuperviso">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione la escolaridad del firmante que supervisa.
                            </small>
                        </div>
                    </div>
                    <div class="form-row col-md-4" id="divFirmante">
                        <div class="select2-purple col-lg-12">
                            <label for="firmanteActual">Firmante:</label>
                            <select class="form-control select2bs4" data-dropdown-css-class="select2-purple" id="firmanteSuperviso">
                                <option value="">Seleccione un servidor público</option>
                                @foreach (var us in Model.Usuarios)
                                {
                                    <option value="@us.Id">@us.NombreEmp @us.PaternoEmp @us.MaternoEmp</option>
                                }
                            </select>
                        </div>
                        <div class="col-sm-12" id="error_firmanteSuperviso">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el firmante que supervisa.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="actualizarFirmante">Guardar Firmantes</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin del Modal para Capturar Oficios*@


@section Scripts {
    <script>
        $(function () {
            $('#error_filePDF').css('display', 'none');
            $('#error_fileXML').css('display', 'none');
            $('#error_TipoDocumentacion').css('display', 'none');
            $('#error_entregablePDF').css('display', 'none');

            $("#error_escolaridadReviso").css("display", "none");
            $("#error_firmanteReviso").css("display", "none");
            $("#error_escolaridadSuperviso").css("display", "none");
            $("#error_firmanteSuperviso").css("display", "none");

            $('[data-toggle="tooltip"]').tooltip();
            $(".conceptosFactura").css("display", "none");

            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                var target = $(e.target).attr("href") // activated tab
                localStorage.setItem('activeTab', target);
            });

            $(".select2").select2();

            $('.select2bs4').select2({
                theme: 'bootstrap4'
            });

            localStorage.getItem('activeTab')

            $(document).on('click', '.number-spinner button', function () {
                var btn = $(this),
                    oldValue = btn.closest('.number-spinner').find('input').val().trim(),
                    newVal = 0;

                if (btn.attr('data-dir') == 'up') {
                    newVal = parseInt(oldValue) + 1;
                } else {
                    if (oldValue > 0) {
                        newVal = parseInt(oldValue) - 1;
                    } else {
                        newVal = 0;
                    }
                }
                btn.closest('.number-spinner').find('input').val(newVal);
            });

            if (localStorage.getItem('activeTab')) {
                var idTab = localStorage.getItem('activeTab').replace("#", "");
                $('#myTab li:first').removeClass('active');
                $('a[href="' + localStorage.getItem('activeTab') + '"]').addClass('active');
                $('#myTab li:first').removeClass("show active");
                $("#" + idTab).addClass("show active");
            }

            $(".btnXML").click(function () {
                $("#modalXML").modal('show');
            });

            $(".cabeceraInformacionG").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraInformacion").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraContrato").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraInmueble").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraFacturacion").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraCedula").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraEntregables").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraPenalizaciones").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraGuiasNE").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraSegCedula").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $(".cabeceraSegEntregables").click(function () {
                $header = $(this);
                $content = $header.next();
                $content.slideToggle(500, function () {
                });
            });

            $('.viewConceptosF').click(function () {
                let factura = $(this).data('factura');
                if ($("#conceptoFactura_" + factura).css('display') == 'none') {
                    $("#conceptoFactura_" + factura).css("display", "block");
                }
                else {
                    $("#conceptoFactura_" + factura).css("display", "none");
                }
            });

            $(".viewConceptosF").click(function () {
                if ($("#viewConceptos_" + $(this).data('factura') + " > i").hasClass("text-success")) {
                    $("#viewConceptos_" + $(this).data('factura') + " > i").removeClass("text-success");
                    $("#viewConceptos_" + $(this).data('factura') + "> i").addClass("text-danger");
                } else {
                    $("#viewConceptos_" + $(this).data('factura') + " > i").removeClass("text-danger");
                    $("#viewConceptos_" + $(this).data('factura') + " > i").addClass("text-success");
                }
            });

            /*********************************** Apartado de Evaluación **********************************/
            const modulo = @Html.Raw(Json.Serialize(@Model.Modulo));
            const servicio = @Html.Raw(Json.Serialize(@Model.Servicio));
            const supervision = @Html.Raw(Json.Serialize(@Model.Supervision));
            const submodulo = @Html.Raw(Json.Serialize(@Model.Submodulo));
            const inmueble = @Html.Raw(Json.Serialize(@Model.Inmueble));
            const respuestas = @Html.Raw(Json.Serialize(@Model.Respuestas));
            const facturas = @Html.Raw(Json.Serialize(@Model.Facturas));
            const repositorio = @Html.Raw(Json.Serialize(@Model.Repositorio.Id));
            const existsNC = @Html.Raw(Json.Serialize(@Model.Facturas.Where(f => f.Tipo.Equals("NC")).Count()));
            const cedula = @Html.Raw(Json.Serialize(@Model.Cedula));
            const configuracion = @Html.Raw(Json.Serialize(@Model.ConfiguracionIncidencias));
            const entregables = @Html.Raw(Json.Serialize(@Model.Cedula.entregables));
            const rechazarTramite = @Html.Raw(Json.Serialize(@Model.Cedula.entregables.Where(e => e.estatus.Nombre.Equals("Rechazado")).Count()));
            const usuario = @Html.Raw(Json.Serialize(User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier).Value));
            const penasDeductivas = @Html.Raw(tdeductivas);


            if (rechazarTramite == 0) {
                $(".tramiteRechazado").remove();
            }
            else {
                $(".autorizarCAE").remove();
                $(".tramitePago").remove();
            }

            $(".tblIncidencias").DataTable({
                responsive: true,
                searching: false,
                bPaginate: false,
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            $(".tblLogCedula").DataTable({
                responsive: true,
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            $(".tblLogEntregables").DataTable({
                responsive: true,
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            $('#tblGuias').DataTable({
                dom: 'lBfrtip',
                buttons: [
                    {
                        extend: 'excelHtml5',
                        title: 'Listado de Soporte de Pago',
                        className: "bg-cjf mr-1",
                    },
                    {
                        extend: 'pdfHtml5',
                        title: 'Listado de Soporte de Pago',
                        className: "bg-cjf mr-1",
                        orientation: "landscape"
                    },
                    {
                        extend: 'print',
                        title: 'Listado de Soporte de Pago',
                        text: 'Imprimir',
                        className: "bg-cjf mr-1"
                    }
                ],
                lengthMenu: [[15, 25, 50, -1], [15, 25, 50, "Todos"]],
                responsive: true,
                stateSave: true,
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            $('.dtlIncidencias').DataTable({
                lengthMenu: [[15, 25, 50, -1], [15, 25, 50, "Todos"]],
                responsive: true,
                language: {
                    url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            for (var i = 0; i < respuestas.length; i++) {
                if (respuestas[i].detalles == "N/A" || respuestas[i].detalles == "N/E" || respuestas[i].detalles == "N/R") {
                    $('input:radio[name="' + respuestas[i].cuestionario.abreviacion + '"][value="' + respuestas[i].detalles + '"]').prop('checked', true);
                }
                else {
                    $('input:radio[name="' + respuestas[i].cuestionario.abreviacion + '"][value="' + respuestas[i].respuesta + '"]').prop('checked', true);
                }
            }

            if (cedula.estatus.nombre == "Revisión CAE" || cedula.estatus.nombre == "Autorizado CAE" || cedula.estatus.nombre == "En Trámite"
                || cedula.estatus.nombre == "Trámite de Pago" || cedula.estatus.nombre == "Trámite Rechazado") {
                $(".cuerpoCedula").css("display", "none");
                $(".cuerpoEntregables").css("display", "block");
            }
            else if (cedula.estatus.nombre == "Sin Iniciar" || cedula.estatus.nombre == "En Proceso" || cedula.estatus.nombre == "Rechazada") {
                $(".cuerpoCedula").css("display", "block");
                $(".cuerpoEntregables").css("display", "block");
            }
            else if (cedula.estatus.nombre == "Autorizada") {
                $(".cuerpoCedula").css("display", "block");
                $(".cuerpoEntregables").css("display", "block");
                $(".cuerpoPenalizaciones").css("display", "block");
            }

            /*********************************** Apartado de Evaluación **********************************/

            /*********************************** Apartado de Incidencias **********************************/
            $(".addIncidencia").click(function () {
                limpiaCampos();
                if ($(this).data('respuesta') == null || $(this).data('respuesta') == "") {
                    Swal.fire({
                        icon: 'error',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: 'Por favor seleccione una respuesta antes de capturar incidencias u observaciones.'
                    });
                }
                else {
                    $(".titleAddI").text("Registrar Incidencia - " + $(this).data("titulo"));
                    ocultaCamposIncidencia();
                    muestraCamposIncidencia($(this).data("preguntaid"), $(this).data("abreviacion"));
                    $(".btnAyudaI").attr('data-ayuda', $(this).data('ayuda'));
                    $("#campoPregunta").val($(this).data("pregunta"));
                    $("#campoPreguntaId").val($(this).data("preguntaid"));
                    $("#campoAbreviacion").val($(this).data("abreviacion"));
                    $("#campoIncidenciaId").val($(this).data("incidenciaid"));
                    $('.chkEnseres').prop("checked", false);
                    axios.get('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?Incidencia=' + $(this).data("incidenciaid") + '&handler=IndemnizacionByIncidencia').then(response => {
                        if (response.status == 200) {
                            var options = '<option value="0">Seleccione una opción</option>';
                            for (var i = 0; i < response.data.length; i++) {
                                options += '<option value="' + response.data[i].id + '">' + response.data[i].nombre + '</option>'
                            }
                            $("#campoTipoIndemnizacion").html(options);
                        }
                    });
                    $("#modal-incidencias").modal("show");
                }
            });

            function limpiaCampos() {
                $("#campoIdIncidencia").val("");
                $("#campoIncidenciaId").val("");
                $("#campoPregunta").val("");
                $("#campoPreguntaId").val("");
                $("#campoFechaIncidencia").val("");
                $("#campoFechaProgramada").val("");
                $("#campoUltimoDia").val("");
                $("#campoFechaRealizada").val("");
                $("#campoFechaInv").val("");
                $("#campoFechaLimite").val("");
                $("#campoFechaNotificacion").val("");
                $("#campoFechaAcordadaAdmin").val("");
                $("#campoFechaEntrega").val("");
                $("#campoHoraInicio").val("");
                $("#campoHoraReal").val("");
                $(".campoCantidad").val(1);
                $("#campoPonderacion").val(0);
                $('.iMateriaPrima').each(function () {
                    if ($(this).prop('checked') == true) {
                        $(this).prop('checked', false);
                    }
                });

                $('.iAbasto').each(function () {
                    if ($(this).prop('checked') == true) {
                        $(this).prop('checked', false);
                    }
                });
            }

            function ocultaCamposIncidencia() {
                $("#divFechaIncidencia").css("display", "none");
                $("#divFechaProgramada").css("display", "none");
                $("#divUltimoDia").css("display", "none");
                $("#divFechaRealizada").css("display", "none");
                $("#divFechaInventario").css("display", "none");
                $("#divFechaNotificacion").css("display", "none");
                $("#divFechaAcordadaAdmin").css("display", "none");
                $("#divFechaLimite").css("display", "none");
                $("#divFechaEntrega").css("display", "none");
                $("#divHoraInicio").css("display", "none");
                $("#divHoraReal").css("display", "none");
                $("#divCantidad").css("display", "none");
                $("#divEntregaEnseres").css("display", "none");
                $("#divIncidenciasMP").css("display", "none");
                $("#divIncidenciasAbasto").css("display", "none");
                $("#divPonderacion").css("display", "none");
                $("#divObservaciones").css("display", "none");
                $("#error_campoFechaIncidencia").css("display", "none");
                $("#error_campoFechaProgramada").css("display", "none");
                $("#error_campoUltimoDia").css("display", "none");
                $("#error_campoFechaRealizada").css("display", "none");
                $("#error_campoFechaInv").css("display", "none");
                $("#error_campoFechaNotificacion").css("display", "none");
                $("#error_campoFechaAcordadaAdmin").css("display", "none");
                $("#error_campoFechaEntrega").css("display", "none");
                $("#error_campoHoraInicio").css("display", "none");
                $("#error_campoHoraReal").css("display", "none");
                $("#error_campoCantidad").css("display", "none");
                $("#error_observaciones").css("display", "none");
            }

            $("#campoFechaInv").change(function () {
                if ($("#campoAbreviacion").val() == "EnseresTipoA") {
                    Swal.fire({
                        allowOutsideClick: false,
                        icon: "info",
                        title: servicio.descripcion,
                        html: "Obteniendo la fecha limite para la entrega de los enseres, espere por favor."
                    });
                    Swal.showLoading();
                    axios.get('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?Fecha=' + $(this).val() + '&handler=FechaLimiteEnseresA')
                        .then(response => {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: servicio.descripcion,
                                html: "La fecha limite para la entrega de los enseres es el: <b>" + response.data.slice(8, 10) + "/" + response.data.slice(5, 7) + "/" + response.data.slice(0, 4),
                                confirmButtonText: 'Cerrar'
                            });
                            Swal.hideLoading();
                            $("#campoFechaLimite").val(response.data.slice(0, 10));
                        });
                }
            });

            $("#campoFechaNotificacion").change(function () {
                Swal.fire({
                    allowOutsideClick: false,
                    icon: "info",
                    title: servicio.descripcion,
                    html: "Obteniendo la fecha limite para la entrega de los enseres, espere por favor."
                });
                Swal.showLoading();
                axios.get('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?Fecha=' + $(this).val() + '&handler=FechaLimiteEnseresB')
                    .then(response => {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "info",
                            title: servicio.descripcion,
                            html: "La fecha limite para la entrega de los enseres es el: <b>" + response.data.slice(8, 10) + "/" + response.data.slice(5, 7) + "/" + response.data.slice(0, 4),
                            confirmButtonText: 'Cerrar'
                        });
                        Swal.hideLoading();
                        $("#campoFechaLimite").val(response.data.slice(0, 10));
                    });
            });

            $(document).on("click", ".editIncidencia", function () {
                limpiaCampos();
                ocultaCamposIncidencia();
                editarIncidencia($(this).data("pregunta"), $(this).data("incidencia"), $(this).data("abreviacion"));
                $(".titleAddI").text("Editar Incidencia - " + $(this).data("titulo"));
                $("#campoIdIncidencia").val($(this).data("incidencia"));
                $("#campoIncidenciaId").val($(this).data("incidenciaid"));
                $("#campoPregunta").val($(this).data("pregunta"));
                $("#campoPreguntaId").val($(this).data("preguntaid"));
                $("#campoAbreviacion").val($(this).data("abreviacion"));
                $("#modal-incidencias").modal("show");
            });

            $(document).on('change', '.chkEnseres', function () {
                var pregunta = $("#campoPreguntaId").val();
                var abreviacion = $("#campoAbreviacion").val();
                var entregaEnseres = $('input:radio[name="chkEnseres"]:checked').val();
                $('#campoFechaInv').val('');
                $('#campoFechaEntrega').val('');
                $('#campoFechaNotificacion').val('');
                $('#campoAcordadaAdmin').val('');
                $('.campoCantidad').val(1);
                $('#campoObservaciones').val('');
                muestraCamposIncidencia2(pregunta, abreviacion, entregaEnseres);
            });

            function muestraCamposIncidencia(pregunta, abreviacion) {
                for (var i = 0; i < configuracion.length; i++) {
                    let respuesta = $("input[name='" + abreviacion + "']:checked").val();
                    if (configuracion[i].pregunta == pregunta && configuracion[i].respuesta + "" == respuesta) {
                        if (configuracion[i].fechaIncidencia) {
                            $("#divFechaIncidencia").css("display", "block");
                            if (abreviacion == "Cierre") {
                                $("#divFechaIncidencia > label").text("Fecha de Cierre");
                            }
                        }


                        if (configuracion[i].materiaPrima) {
                            $("#divIncidenciasMP").css("display", "block");
                        }

                        if (configuracion[i].abasto) {
                            $("#divIncidenciasAbasto").css("display", "block");
                        }

                        if (configuracion[i].fechaProgramada) {
                            $("#divFechaProgramada").css("display", "block");
                        }

                        if (configuracion[i].ultimoDia) {
                            $("#divUltimoDia").css("display", "block");
                        }

                        if (configuracion[i].horaInicio) {
                            $("#divHoraInicio").css("display", "block");
                            if (abreviacion == "HorariosMP") {
                                $("#divHoraInicio> label").text("Hora Programada");
                            } else if (abreviacion == "HorariosServicio") {
                                $("#campoHoraInicio").val(inmueble.horarioComedor);
                                $("#campoHoraInicio").prop("disabled", true);
                            }
                        }

                        if (configuracion[i].horaReal) {
                            $("#divHoraReal").css("display", "block");
                            if (abreviacion == "HorariosMP") {
                                $("#divHoraReal> label").text("Hora Entrega");
                            }
                        }

                        if (configuracion[i].ponderacion) {
                            $("#divPonderacion").css("display", "block");
                        }

                        if (configuracion[i].entregaEnseres) {
                            $("#divEntregaEnseres").css("display", "block");
                        }

                        if (abreviacion.indexOf("Enseres") == -1) {
                            if (configuracion[i].fechaEntrega) {
                                $("#divFechaEntrega").css("display", "block");
                                if (abreviacion == "Recoleccion") {
                                    $("#divFechaEntrega> label").text("Fecha de Recolección");
                                }
                            }

                            if (configuracion[i].cantidad) {
                                $("#divCantidad").css("display", "block");
                            }

                            if (configuracion[i].observaciones) {
                                $("#divObservaciones").css("display", "block");
                            }
                        }

                        return;
                    }
                }
            }

            function muestraCamposIncidencia2(pregunta, abreviacion, entregaEnseres) {
                for (var i = 0; i < configuracion.length; i++) {
                    let respuesta = $("input[name='" + abreviacion + "']:checked").val();
                    if (configuracion[i].pregunta == pregunta && configuracion[i].respuesta + "" == respuesta) {

                        if (configuracion[i].fechaInventario) {
                            $("#divFechaInventario").css("display", "block");
                        }

                        if (configuracion[i].fechaNotificacion) {
                            $("#divFechaNotificacion").css("display", "block");
                        }

                        if (configuracion[i].fechaAcordadaAdmin) {
                            $("#divFechaAcordadaAdmin").css("display", "block");
                        }

                        if (configuracion[i].fechaLimite) {
                            $("#divFechaLimite").css("display", "block");
                        }

                        if (configuracion[i].cantidad) {
                            $("#divCantidad").css("display", "block");
                        }

                        if (entregaEnseres == "false") {
                            if (configuracion[i].fechaEntrega) {
                                $("#divFechaEntrega").css("display", "none");
                            }
                        } else {
                            if (configuracion[i].fechaEntrega) {
                                $("#divFechaEntrega").css("display", "block");
                            }
                        }

                        if (configuracion[i].observaciones) {
                            $("#divObservaciones").css("display", "block");
                        }

                        return;
                    }
                }
            }

            function editarIncidencia(pregunta, id, abreviacion) {
                for (var i = 0; i < respuestas[pregunta - 1].iComedor.length; i++) {
                    let respuesta = $("input[name='" + abreviacion + "']:checked").val();
                    if (respuestas[pregunta - 1].iComedor[i].id == id && respuestas[pregunta - 1].respuesta + "" == respuesta) {
                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaIncidencia) {
                            $("#campoFechaIncidencia").val(respuestas[pregunta - 1].iComedor[i].fechaIncidencia.slice(0, 10));
                            if (abreviacion == "Cierre") {
                                $("#divFechaIncidencia > label").text("Fecha de Cierre");
                            }
                            $("#divFechaIncidencia").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.materiaPrima) {
                            var dIncidencias = respuestas[pregunta - 1].iComedor[i].dIncidencias;

                            for (var j = 0; j < dIncidencias.length; j++) {
                                $("#checkboxSuccess_" + dIncidencias[j].cIncidenciaId).prop("checked", true);
                            }
                            $("#divIncidenciasMP").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.abasto) {
                            var dIncidencias = respuestas[pregunta - 1].iComedor[i].dIncidencias;

                            for (var j = 0; j < dIncidencias.length; j++) {
                                $("#checkboxSuccess_iA" + dIncidencias[j].cIncidenciaId).prop("checked", true);
                            }
                            $("#divIncidenciasAbasto").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaProgramada) {
                            $("#campoFechaProgramada").val(respuestas[pregunta - 1].iComedor[i].fechaProgramada.slice(0, 10));
                            $("#divFechaProgramada").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.ultimoDia) {
                            $("#campoUltimoDia").val(respuestas[pregunta - 1].iComedor[i].ultimoDia.slice(0, 10));
                            $("#divUltimoDia").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaInventario) {
                            $("#campoFechaInv").val(respuestas[pregunta - 1].iComedor[i].fechaInventario.slice(0, 10));
                            $("#divFechaInventario").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaAcordadaAdmin) {
                            $("#campoFechaAcordadaAdmin").val(respuestas[pregunta - 1].iComedor[i].fechaAcordadaAdmin.slice(0, 10));
                            $("#divFechaAcordadaAdmin").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.horaInicio) {
                            $("#campoHoraInicio").val(respuestas[pregunta - 1].iComedor[i].horaInicio.slice(0, 10));
                            $("#divHoraInicio").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.horaReal) {
                            $("#campoHoraReal").val(respuestas[pregunta - 1].iComedor[i].horaReal.slice(0, 10));
                            $("#divHoraReal").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.ponderacion) {
                            console.log(respuestas[pregunta - 1].iComedor[i].ponderacion);
                            $("#campoPonderacion").val(respuestas[pregunta - 1].iComedor[i].ponderacion);
                            $("#divPonderacion").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.cantidad) {
                            $(".campoCantidad").val(respuestas[pregunta - 1].iComedor[i].cantidad);
                            $("#divCantidad").css("display", "block");
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.entregaEnseres) {
                            if (respuestas[pregunta - 1].iComedor[i].entregaEnseres) {
                                $("#enseresChk1").prop("checked", true);
                                if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaNotificacion) {
                                    $("#campoFechaNotificacion").val(respuestas[pregunta - 1].iComedor[i].fechaNotificacion.slice(0, 10));
                                    $("#divFechaNotificacion").css("display", "block");
                                }

                                if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaEntrega) {
                                    $("#campoFechaEntrega").val(respuestas[pregunta - 1].iComedor[i].fechaEntrega.slice(0, 10));
                                    $("#divFechaEntrega").css("display", "block");
                                }
                            }
                            else {
                                $("#enseresChk2").prop("checked", true);
                            }

                            $("#divEntregaEnseres").css("display", "block");
                        }
                        else {
                            if (respuestas[pregunta - 1].iComedor[i].ciComedor.fechaEntrega) {
                                $("#campoFechaEntrega").val(respuestas[pregunta - 1].iComedor[i].fechaEntrega.slice(0, 10));
                                $("#divFechaEntrega").css("display", "block");
                            }
                        }

                        if (respuestas[pregunta - 1].iComedor[i].ciComedor.observaciones) {
                            $("#campoObservaciones").val(respuestas[pregunta - 1].iComedor[i].observaciones);
                            $("#divObservaciones").css("display", "block");
                        }

                        return;
                    }
                }
            }

            function validaCamposByPregunta(pregunta) {
                var denegate = false;
                for (var i = 0; i < configuracion.length; i++) {
                    if (configuracion[i].pregunta == pregunta && configuracion[i].obligatorio) {
                        if (configuracion[i].observaciones) {
                            if ($("#campoObservaciones").val() == "") {
                                denegate = true;
                                $("#error_observaciones").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No se han capturado las <b>Observaciones</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].ultimoDia) {
                            if ($("#campoUltimoDia").val() == "") {
                                denegate = true;
                                $("#error_campoUltimoDia").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado el <b>Último día</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].ultimoDia && configuracion[i].fechaProgramada) {
                            var anioMax = @Html.Raw(Json.Serialize(DateTime.Now.Year + 1));
                            var anioMin = @Html.Raw(Json.Serialize(DateTime.Now.Year - 1));

                            var anioFP = $("#campoFechaProgramada").val().split("-")[0];
                            var anioFE = $("#campoUltimoDia").val().split("-")[0];

                            if (parseInt(anioFP) < anioMin || parseInt(anioFP) > anioMax) {
                                denegate = true;
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "El año de la <b>Fecha Programada</b> no es válido."
                                }).then(function () {
                                    return false;
                                });
                            }

                            if (parseInt(anioFE) < anioMin || parseInt(anioFE) > anioMax) {
                                denegate = true;
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "El año de la <b>Fecha de Entrega</b> no es válido."
                                }).then(function () {
                                    return false;
                                });
                            }

                            if ($("#campoUltimoDia").val() <= $("#campoFechaProgramada").val()) {
                                denegate = true;
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "El <b>Último día</b> debe ser mayor a la <b>Fecha Programada</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].fechaEntrega && configuracion[i].fechaProgramada) {
                            var anioMax = @Html.Raw(Json.Serialize(DateTime.Now.Year + 1));
                            var anioMin = @Html.Raw(Json.Serialize(DateTime.Now.Year - 1));

                            var anioFP = $("#campoFechaProgramada").val().split("-")[0];
                            var anioFE = $("#campoFechaEntrega").val().split("-")[0];

                            if (parseInt(anioFP) < anioMin || parseInt(anioFP) > anioMax) {
                                denegate = true;
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "El año de la <b>Fecha Programada</b> no es válido."
                                }).then(function () {
                                    return false;
                                });
                            }

                            if (parseInt(anioFE) < anioMin || parseInt(anioFE) > anioMax) {
                                denegate = true;
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "El año de la <b>Fecha de Entrega</b> no es válido."
                                }).then(function () {
                                    return false;
                                });
                            }

                            if ($("#campoFechaEntrega").val() <= $("#campoFechaProgramada").val()) {
                                if (configuracion[i].horaInicio && configuracion[i].horaReal) {
                                    if ($("#campoFechaEntrega").val() == $("#campoFechaProgramada").val()
                                        && $("#campoHoraReal").val() <= $("#campoHoraInicio").val()) {
                                        denegate = true;
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': servicio.descripcion,
                                            'html': "La <b>Hora de Entrega</b> debe ser mayor a la <b>Hora Programada</b>."
                                        }).then(function () {
                                            return false;
                                        });
                                    }
                                    else if ($("#campoFechaEntrega").val() < $("#campoFechaProgramada").val()) {
                                        denegate = true;
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': servicio.descripcion,
                                            'html': "La <b>Fecha de Entrega</b> debe ser mayor a la <b>Fecha Programada</b>."
                                        }).then(function () {
                                            return false;
                                        });
                                    }
                                    else if ($("#campoHoraReal").val() <= $("#campoHoraInicio").val()) {
                                        denegate = true;
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': servicio.descripcion,
                                            'html': "La <b>Hora de Entrega</b> debe ser mayor a la <b>Hora Programada</b>."
                                        }).then(function () {
                                            return false;
                                        });
                                    }
                                } else {
                                    denegate = true;
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': servicio.descripcion,
                                        'html': "La <b>Fecha de Entrega</b> debe ser mayor a la <b>Fecha Programada</b>."
                                    }).then(function () {
                                        return false;
                                    });
                                }
                            }
                        }

                        if (configuracion[i].horaInicio) {
                            if ($("#campoHoraInicio").val() == "") {
                                denegate = true;
                                $("#error_campoHoraInicio").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Hora de Inicio</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].horaReal) {
                            if ($("#campoHoraReal").val() == "") {
                                denegate = true;
                                $("#error_campoHoraReal").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Hora Real</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].horaInicio && configuracion[i].horaReal) {
                            if ($("#campoHoraReal").val() <= $("#campoHoraInicio").val() && !configuracion[i].fechaEntrega) {
                                denegate = true;
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "La <b>Hora de Inicio</b> debe ser mayor a la <b>Hora Real</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].cantidad) {
                            if ($("#campoCantidad").val() == "") {
                                denegate = true;
                                $("#error_cantidad").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No se han capturado las <b>Cantidad</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].fechaIncidencia) {
                            if ($("#campoFechaIncidencia").val() == "") {
                                denegate = true;
                                $("#error_campoFechaIncidencia").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Fecha de la Incidencia/Cierre</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].fechaProgramada) {
                            if ($("#campoFechaProgramada").val() == "") {
                                denegate = true;
                                $("#error_campoFechaProgramada").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Fecha Programada</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (!configuracion[i].entregaEnseres) {
                            if (configuracion[i].fechaEntrega) {
                                if ($("#campoFechaEntrega").val() == "") {
                                    denegate = true;
                                    $("#error_campoFechaEntrega").css("display", "block");
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': servicio.descripcion,
                                        'html': "No ha capturado la <b>Fecha de Entrega</b>."
                                    }).then(function () {
                                        return false;
                                    });
                                }
                            }
                        }

                        if (configuracion[i].fechaAcordadaAdmin) {
                            if ($("#campoFechaAcordadaAdmin").val() == "") {
                                denegate = true;
                                $("#error_campoFechaAcordadaAdmin").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Fecha acordada por la administración</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].fechaNotificacion) {
                            if ($("#campoFechaNotificacion").val() == "") {
                                denegate = true;
                                $("#error_campoFechaNotificacion").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Fecha de notificación</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].fechaInventario) {
                            if ($("#campoFechaInv").val() == "") {
                                denegate = true;
                                $("#error_campoFechaInv").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha capturado la <b>Fecha del inventario/Cierre</b>."
                                }).then(function () {
                                    return false;
                                });
                            }
                        }

                        if (configuracion[i].entregaEnseres) {
                            if ($('input:radio[name="chkEnseres"]:checked').val() != "true" && $('input:radio[name="chkEnseres"]:checked').val() != "false") {
                                denegate = true;
                                $("#error_entregaEnseres").css("display", "block");
                                Swal.fire({
                                    'icon': 'error',
                                    'title': servicio.descripcion,
                                    'html': "No ha seleccionado si <b>Cumplió con la entrega completa de enseres.</b>"
                                }).then(function () {
                                    return false;
                                });
                            }
                            else {
                                if ($('input:radio[name="chkEnseres"]:checked').val() == "true") {
                                    if ($("#campoFechaEntrega").val() == "") {
                                        denegate = true;
                                        $("#error_campoFechaEntrega").css("display", "block");
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': servicio.descripcion,
                                            'html': "No ha capturado la <b>Fecha de Entrega</b>."
                                        }).then(function () {
                                            return false;
                                        });
                                    }
                                }
                            }
                        }
                    }
                }

                if (denegate == false) {
                    return true;
                }
            }

            $("#guardaIncidencia").click(function () {
                var idIncidencia = $("#campoIdIncidencia").val() != "" ? $("#campoIdIncidencia").val() : 0;
                var incidenciaId = $("#campoIncidenciaId").val();
                var pregunta = $("#campoPregunta").val();
                var preguntaId = $("#campoPreguntaId").val();
                var fechaIncidencia = $("#campoFechaIncidencia").val() != null && $("#campoFechaIncidencia").val() != "" ? $("#campoFechaIncidencia").val() : "1990-01-01";
                var fechaProgramada = $("#campoFechaProgramada").val() != null && $("#campoFechaProgramada").val() != "" ? $("#campoFechaProgramada").val() : "1990-01-01";
                var ultimoDia = $("#campoUltimoDia").val() != null && $("#campoUltimoDia").val() != "" ? $("#campoUltimoDia").val() : "1990-01-01";
                var fechaRealizada = $("#campoFechaRealizada").val() != null && $("#campoFechaRealizada").val() != "" ? $("#campoFechaRealizada").val() : "1990-01-01";
                var fechaInventario = $("#campoFechaInv").val() != null && $("#campoFechaInv").val() != "" ? $("#campoFechaInv").val() : "1990-01-01";
                var fechaNotificacion = $("#campoFechaNotificacion").val() != null && $("#campoFechaNotificacion").val() != "" ? $("#campoFechaNotificacion").val() : "1990-01-01";
                var fechaAcordadaAdmin = $("#campoFechaAcordadaAdmin").val() != null && $("#campoFechaAcordadaAdmin").val() != "" ? $("#campoFechaAcordadaAdmin").val() : "1990-01-01";
                var fechaLimite = $("#campoFechaLimite").val() != null && $("#campoFechaLimite").val() != "" ? $("#campoFechaLimite").val() : "1990-01-01";
                var fechaEntrega = $("#campoFechaEntrega").val() != null && $("#campoFechaEntrega").val() != "" ? $("#campoFechaEntrega").val() : "1990-01-01";
                var horaInicio = $("#campoHoraInicio").val() != null && $("#campoHoraInicio").val() != "" ? $("#campoHoraInicio").val() : "00:00:00";
                var horaReal = $("#campoHoraReal").val() != null && $("#campoHoraReal").val() != "" ? $("#campoHoraReal").val() : "00:00:00";
                var cantidad = $(".campoCantidad").val() != null && $(".campoCantidad").val() != "" ? $(".campoCantidad").val() : 0;
                var entregaEnseres = $('input:radio[name="chkEnseres"]:checked').val() != null && $('input:radio[name="chkEnseres"]:checked').val() != "" ? $('input:radio[name="chkEnseres"]:checked').val() : false;
                var observaciones = $("#campoObservaciones").val() != null && $("#campoObservaciones").val() != "" ? $("#campoObservaciones").val() : "";
                var ponderacion = $("#campoPonderacion").val() != null && $("#campoPonderacion").val() != "" ? $("#campoPonderacion").val() : 0;
                var dtIncidencias = new Array();

                $('.iMateriaPrima').each(function () {
                    if ($(this).prop('checked') == true) {
                        dtIncidencias.push(parseInt($(this).val()));
                    }
                });

                $('.iAbasto').each(function () {
                    if ($(this).prop('checked') == true) {
                        dtIncidencias.push(parseInt($(this).val()));
                    }
                });


                Swal.fire({
                    allowOutsideClick: false,
                    icon: "info",
                    title: servicio.descripcion,
                    html: "Guardando la incidencia, espere por favor."
                });
                Swal.showLoading();
                if (validaCamposByPregunta(preguntaId)) {
                    if (idIncidencia != 0) {
                        axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=ActualizarIncidencia',
                            {
                                Id: parseInt(idIncidencia), IncidenciaId: parseInt(incidenciaId), CedulaEvaluacionId: parseInt(cedula.id),
                                UsuarioId: usuario, Pregunta: parseInt(pregunta), FechaIncidencia: fechaIncidencia, FechaProgramada: fechaProgramada,
                                UltimoDia: ultimoDia, FechaRealizada: fechaRealizada, FechaInventario: fechaInventario, FechaAcordadaAdmin: fechaAcordadaAdmin,
                                FechaNotificacion: fechaNotificacion, FechaEntrega: fechaEntrega, HoraInicio: horaInicio, HoraReal: horaReal,
                                EntregaEnseres: (entregaEnseres == "true"), FechaLimite: fechaLimite, Ponderacion: parseInt(ponderacion),
                                Cantidad: parseInt(cantidad), Observaciones: observaciones, DTIncidencia: dtIncidencias
                            }).then(response => {
                                if (response.status == 200) {
                                    Swal.fire({
                                        icon: "success",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "La incidencia se actualizó correctamente.",
                                        confirmButtonText: 'Cerrar'
                                    }).then(function () {
                                        $("#modal-incidencias").modal("hide");
                                        Swal.fire({
                                            allowOutsideClick: false,
                                            icon: "info",
                                            'title': servicio.descripcion,
                                            html: "Actualizando las incidencias, espere por favor."
                                        });
                                        Swal.showLoading();
                                        window.location.reload();
                                    });
                                }
                            }).catch(error => {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Hubo un error al insertar la incidencia. Contacte a su administrador del sistema.",
                                    confirmButtonText: 'Cerrar'
                                });
                            });
                    }
                    else {
                        axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=CrearIncidencia',
                            {
                                IncidenciaId: parseInt(incidenciaId), CedulaEvaluacionId: parseInt(cedula.id),
                                UsuarioId: usuario, Pregunta: parseInt(pregunta), FechaIncidencia: fechaIncidencia, FechaProgramada: fechaProgramada,
                                UltimoDia: ultimoDia, FechaRealizada: fechaRealizada, FechaInventario: fechaInventario, FechaAcordadaAdmin: fechaAcordadaAdmin,
                                FechaNotificacion: fechaNotificacion, FechaEntrega: fechaEntrega, HoraInicio: horaInicio, HoraReal: horaReal,
                                EntregaEnseres: (entregaEnseres == "true"), FechaLimite: fechaLimite, Ponderacion: parseInt(ponderacion),
                                Cantidad: parseInt(cantidad), Observaciones: observaciones, DTIncidencia: dtIncidencias
                            }).then(response => {
                                if (response.status == 200) {
                                    Swal.fire({
                                        icon: "success",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "La incidencia se registró correctamente.",
                                        confirmButtonText: 'Cerrar'
                                    }).then(function () {
                                        $("#modal-incidencias").modal("hide");
                                        Swal.fire({
                                            allowOutsideClick: false,
                                            icon: "info",
                                            'title': servicio.descripcion,
                                            html: "Actualizando las incidencias, espere por favor."
                                        });
                                        Swal.showLoading();
                                        window.location.reload();
                                    });
                                }
                            }).catch(error => {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Hubo un error al insertar la incidencia. Contacte a su administrador del sistema.",
                                    confirmButtonText: 'Cerrar'
                                });
                            });
                    }
                }
            });

            $(".eliminarIncidencia").click(function () {
                var formData = new FormData();

                var idIncidencia = $(this).data('id');

                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Eliminar</b> la incidencia de la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Eliminar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=EliminarIncidencia', {
                            Id: parseInt(idIncidencia), CedulaEvaluacionId: parseInt(cedula.id), UsuarioId: usuario
                        }).then(response => {
                            if (response.status == 200) {
                                Swal.fire({
                                    icon: "success",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "La incidencia se eliminó correctamente.",
                                    confirmButtonText: 'Cerrar'
                                }).then(function () {
                                    $("#modal-incidencias").modal("hide");
                                    Swal.fire({
                                        allowOutsideClick: false,
                                        icon: "info",
                                        'title': servicio.descripcion,
                                        html: "Actualizando las incidencias, espere por favor."
                                    });
                                    Swal.showLoading();
                                    window.location.reload();
                                });
                            }
                        }).catch(error => {
                            Swal.fire({
                                icon: "error",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Hubo un error al eliminar la incidencia. Contacte a su administrador del sistema.",
                                confirmButtonText: 'Cerrar'
                            });
                        });
                    }
                });
            });

            $('#campoTotalAcuses').keydown(function (e) {
                setTimeout(() => {
                    let montoMax = $('#campoTotalAcuses').val().split(".");
                    let valorMx = montoMax[0].replace(/\D/g, ""), decimalMx = montoMax[1]

                    let gNumero = Number((decimalMx !== undefined ? valorMx + "." + decimalMx : valorMx));
                    let numeroFmx = new Intl.NumberFormat('en-EN').format(valorMx);
                    numeroFmx = decimalMx !== undefined ? numeroFmx + "." + decimalMx : numeroFmx;
                    $('#campoTotalAcuses').val(numeroFmx);
                })
            });

            $("#campoTotalAcuses").on("input", function () {
                var limite = 6;
                $("#campoTotalAcuses").attr('maxlength', limite);
            });

            $('#campoSobrepeso').on('keyup', function () {
                v = parseInt($(this).val());
                min = parseInt($(this).attr('min'));
                max = parseInt($(this).attr('max'));
                if (v > max) {
                    $(this).val(max);
                }
            });

            $("#campoSobrepeso").change(function () {
                var sel = document.getElementById("campoTipoIndemnizacion");
                var text = sel.options[sel.selectedIndex].text;
                if ($("#campoTipoServicio").val() == "Nacional Sobrepeso" || $("#campoTipoServicio").val() == "Internacional Sobrepeso"
                    || text == "Bienes" || text == "Expediente") {
                    $("#divSobrepeso").css("display", "block");
                } else {
                    $("#divSobrepeso").css("display", "none");
                    $("#total_sobrepeso").val("");
                }
            });

            $("#campoTipoServicio").change(function () {
                if ($(this).val() == "Nacional Sobrepeso" || $(this).val() == "Internacional Sobrepeso") {
                    $("#divSobrepeso").css("display", "block");
                } else {
                    $("#divSobrepeso").css("display", "none");
                    $("#campoTipoIndemnizacion").val(0);
                    $("#campoSobrepeso").val("");
                    $("#total_sobrepeso").val("");
                }
            });

            $("#campoTipoIndemnizacion").change(function () {
                var sel = document.getElementById("campoTipoIndemnizacion");
                var text = sel.options[sel.selectedIndex].text;
                if (text == "Expediente" || text == "Bienes") {
                    if ($("#campoTipoServicio").val() == "Internacional") {
                        $("#campoTipoServicio").val("Internacional Sobrepeso");
                    }
                    else if ($("#campoTipoServicio").val() == "Nacional") {
                        $("#campoTipoServicio").val("Nacional Sobrepeso");
                    }
                    $("#divSobrepeso").css("display", "block");
                } else {
                    if ($("#campoTipoServicio").val() == "Internacional Sobrepeso") {
                        $("#campoTipoServicio").val("Internacional");
                    }
                    else if ($("#campoTipoServicio").val() == "Nacional Sobrepeso") {
                        $("#campoTipoServicio").val("Nacional");
                    }
                    $("#divSobrepeso").css("display", "none");
                    $("#campoSobrepeso").val("");
                    $("#total_sobrepeso").val("");
                }
            });

            $(".pregunta").change(function () {
                var pregunta = $(this).data("pregunta");
                var pusuario = $(this).data("pusuario");
                var abreviacion = $(this).data("abreviacion");
                var respuesta = $("input[name='" + abreviacion + "']:checked").val();
                var obligatorio = $(this).data('obligatorio');

                if (obligatorio == "True" && cuentaIncidencias(cedula.id, pusuario) != 0) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: '<strong>Advertencia:</strong><p>Tiene incidencias capturadas en esta pregunta, al cambiar la respuesta <strong>se eliminarán todas las incidencias. ¿Desea continuar? </strong></p>',
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Si, eliminar',
                        cancelButtonText: 'Cancelar',
                        showCancelButton: true
                    }).then(p => {
                        if (p.isConfirmed) {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Servicio de ' + servicio.descripcion,
                                html: 'Escriba la palabra ELIMINAR en para confirmar el cambio de respuesta.',
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Si, eliminar todo',
                                cancelButtonText: 'Cancelar',
                                showCancelButton: true,
                                input: 'text',
                                inputPlaceholder: 'Escribe la palabra ELIMINAR'
                            }).then(res => {
                                if (res.value == 'ELIMINAR' || res.value == 'eliminar') {
                                    axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=EliminarIncidencias', {
                                        CedulaEvaluacionId: parseInt(cedula.id), Pregunta: parseInt(pusuario)
                                    }).then(response => {
                                        Swal.fire({
                                            allowOutsideClick: false,
                                            icon: "info",
                                            'title': servicio.descripcion,
                                            html: "Eliminando las incidencias, espere por favor."
                                        });
                                        Swal.showLoading();
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: 'Se eliminaron las incidencias de la pregunta ' + pusuario + '.',
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            guardarCedula();
                                        });
                                    });
                                }
                                else if (dismiss = 'cancel') {
                                    $('input:radio[name="' + abreviacion + '"][value="' + (!respuesta + "") + '"]').prop('checked', true);
                                }
                            });
                        }
                        else {
                            $('input:radio[name="' + abreviacion + '"][value="' + (!respuesta + "") + '"]').prop('checked', true);
                        }
                    });
                }
                else {
                    for (var i = 0; i < configuracion.length; i++) {
                        if (configuracion[i].pregunta == pregunta && (respuesta == "true") == configuracion[i].respuesta) {
                            if (respuesta != "N/A" && respuesta != "N/E" && respuesta != "N/R") {
                                guardarCedulaCP(configuracion[i].obligatorio, pusuario, respuesta)
                            }
                            else if (respuesta == "N/A" || respuesta == "N/E" || respuesta == "N/R") {
                                guardarCedulaCP(configuracion[i].obligatorio, pusuario, respuesta)
                            }

                        }
                    }
                }
            });

            $("#campoFechaProgramada").change(function () {
                if ($('#campoFechaProgramada').hasClass('is-invalid')) {
                    $('#campoFechaProgramada').removeClass('is-invalid');
                    $('#campoFechaProgramada').addClass('is-valid');
                    $('#error_campoFechaProgramada').css('display', 'none');
                }
            });

            $("#campoFechaEntrega").change(function () {
                if ($('#campoFechaEntrega').hasClass('is-invalid')) {
                    $('#campoFechaEntrega').removeClass('is-invalid');
                    $('#campoFechaEntrega').addClass('is-valid');
                    $('#error_campoFechaEntrega').css('display', 'none');
                }
            });

            $("#campoCodigoRastreo").change(function () {
                if ($('#campoCodigoRastreo').hasClass('is-invalid')) {
                    $('#campoCodigoRastreo').removeClass('is-invalid');
                    $('#campoCodigoRastreo').addClass('is-valid');
                    $('#error_campoCodigoRastreo').css('display', 'none');
                }
            });

            $("#campoNumeroGuia").change(function () {
                if ($('#campoNumeroGuia').hasClass('is-invalid')) {
                    $('#campoNumeroGuia').removeClass('is-invalid');
                    $('#campoNumeroGuia').addClass('is-valid');
                    $('#error_campoNumeroGuia').css('display', 'none');
                }
            });

            $("#campoAcuses").change(function () {
                if ($('#campoAcuses').hasClass('is-invalid')) {
                    $('#campoAcuses').removeClass('is-invalid');
                    $('#campoAcuses').addClass('is-valid');
                    $('#error_campoAcuses').css('display', 'none');
                }
            });

            $("#campoTipoServicio").change(function () {
                if ($('#campoTipoServicio').hasClass('is-invalid')) {
                    $('#campoTipoServicio').removeClass('is-invalid');
                    $('#campoTipoServicio').addClass('is-valid');
                    $('#error_campoTipoServicio').css('display', 'none');
                }
            });

            $("#campoTotalAcuses").change(function () {
                if ($('#campoTotalAcuses').hasClass('is-invalid')) {
                    $('#campoTotalAcuses').removeClass('is-invalid');
                    $('#campoTotalAcuses').addClass('is-valid');
                    $('#error_campoTotalAcuses').css('display', 'none');
                }
            });

            $("#campoSobrepeso").change(function () {
                if ($('#campoSobrepeso').hasClass('is-invalid')) {
                    $('#campoSobrepeso').removeClass('is-invalid');
                    $('#campoSobrepeso').addClass('is-valid');
                    $('#error_campoSobrepeso').css('display', 'none');
                }
            });


            /*********************************** Apartado de Incidencias **********************************/

            /*********************************** Apartado de Entregables **********************************/
            $(".editarEntregable").click(function () {
                $(".tituloEntregable").html('<h4 class="modal-title text-white">Cargar entregable - ' + $(this).data("tipo") + '</h4>');
                if ($(this).data("tipo") == "Factura" || $(this).data("tipo").includes("SAT")) {
                    $("#notaEntregable").html('<b>Nota:</b> Recuerde que la <b>Factura, Nota de Crédito, Validación del SAT y Validación del SAT (NC)</b> <b class="text-danger">deben ir firmadas y selladas</b> por la administración del inmueble.');
                }
                $("#campoIdEntregable").val($(this).data("id"));
                $("#campoTipoEntregable").val($(this).data("tipo"));
                $("#campoentregableid").val($(this).data("entregableid"));
                $(".custom-pdf").text($(this).data("file"));
                $("#modalEntregables").modal('show');
            });

            $("#entregablePDF").on("change", function () {
                var fileName = $(this).val().split("\\").pop();
                var ext = fileName.split('.').pop();
                if (ext == "pdf" || ext == "PDF") {
                    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Formato Incorrecto',
                        'text': 'El archivo que intentas adjuntar no es válido. Favor de solo seleccionar archivos "PDF"'
                    });
                    $(".custom-file-label").text("Seleccionar Archivo");
                    document.getElementById('customFile').value = '';
                    if ($('#entregablePDF').hasClass('is-valid')) {
                        $('#entregablePDF').removeClass('is-valid');
                    }
                    $('#entregablePDF').addClass('is-invalid');
                    $('#error_entregablePDF').css('display', 'block');
                }
            });

            $("#guardarEntregable").click(function () {
                var formData = new FormData();
                var filePDF = document.getElementById('entregablePDF').files[0];
                var observaciones = "Se actualizó el entregable: " + $("#campoTipoEntregable").val() + ".";

                formData.append("Id", $("#campoIdEntregable").val());
                formData.append("UsuarioId", usuario);
                formData.append("EstatusId", cedula.estatusId);
                formData.append("Archivo", filePDF);
                formData.append("Anio", parseInt(cedula.anio));
                formData.append("Mes", cedula.mes.nombre);
                formData.append("Folio", cedula.folio);
                formData.append("Archivo", filePDF);
                formData.append("Supervicion", supervision);
                formData.append("Observaciones", observaciones);
                formData.append("TipoEntregable", $("#campoTipoEntregable").val());

                Swal.fire({
                    allowOutsideClick: false,
                    icon: "info",
                    'title': servicio.descripcion,
                    html: "Guardando entregable, espere por favor."
                });
                Swal.showLoading();
                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=ActualizarEntregables', formData, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => {
                    if (response.status == 200) {
                        Swal.fire({
                            icon: "success",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: 'El entregable <b>' + $("#campoTipoEntregable").val() + '</b> se actualizó correctamente.',
                            confirmButtonText: 'Cerrar'
                        }).then(function () {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Actualizando el listado de entregables, espere por favor."
                            });
                            Swal.showLoading();
                            window.location.reload();
                        });
                    }
                });
            });

            $(".verEntregable").click(function () {
                var folio = cedula.folio;
                var abreviacion = $(this).data("tipo");
                var archivo = $(this).data("archivo");
                var tipoEntregable = $(this).data("tipo");
                var observaciones = $(this).data("observaciones");

                let url = '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?cAnio=' + @Model.Cedula.Anio+'&cMes=' + cedula.mes.nombre + '&cFolio=' + folio + '&cArchivo=' + archivo + '&tipo=' + tipoEntregable + '&handler=VisualizarEntregable';
                let data = '<object class="vistaPdf" embedded=True data="' + url + '"></object>';
                let detail = '<tr>' +
                    '<td><label>Año: </label> ' + cedula.anio + '</td>' +
                    '<td><label>Mes: </label> ' + cedula.mes.nombre + '</td>' +
                    '<td><label>Inmueble: </label> ' + cedula.inmueble.nombre + '</td>' +
                    '<td><label>Folio: </label> ' + cedula.folio + '</td>' +
                    '<td><label>Estatus: </label> ' + cedula.estatus.nombre + '</td>' +
                    '</tr>';
                let detail2 = '<tr>' +
                    '<td colspan="5"><label>Administrador: </label> ' + inmueble.administrador + '</td>'
                '</tr>';
                $("#titleVerEntregables").text("Vista del entregable - " + abreviacion);
                $('#detalleEntregable').html('<table class="table">' + detail + detail2 + '</table>');
                $('#objectPdf').html(data);
                $("#modalVerEntregables").modal("show");
            });

            $(".verFactura").click(function () {
                var folio = $(this).data("folio");
                var archivo = $(this).data("archivo");
                var tipo = $(this).data("tipo");
                var subtotal = $(this).data("subtotal");
                var total = $(this).data("total");
                var iva = $(this).data("iva");

                let url = '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?cAnio=' + @Model.Cedula.Anio+'&cMes=' + cedula.mes.nombre + '&cFolio=' + folio + '&cInmueble=' + inmueble.nombre + '&cArchivo=' + archivo + '&tipo=' + tipo + '&handler=VisualizarFactura';
                let data = '<object class="vistaPdf" embedded=True data="' + url + '"></object>';
                let detail = '<tr>' +
                    '<td><label>Año: </label> ' + cedula.anio + '</td>' +
                    '<td><label>Mes: </label> ' + cedula.mes.nombre + '</td>' +
                    '<td><label>Inmueble: </label> ' + inmueble.nombre + '</td>' +
                    '<td><label>Folio: </label> ' + folio + '</td>' +
                    '<td><label>Tipo: </label> ' + tipo + '</td>' +
                    '</tr>';

                let detail2 = '<tr>' +
                    '<td><label>Subtotal: </label> ' + subtotal + '</td>' +
                    '<td><label>IVA: </label> ' + iva + '</td>' +
                    '<td><label>Total: </label> ' + total + '</td>' +
                    '<td></td>' +
                    '<td></td>' +
                    '</tr>';
                $("#titleVerEntregables").text("Vista del entregable - " + tipo);
                $('#detalleEntregable').html('<table class="table">' + detail + detail2 + '</table>');
                $('#objectPdf').html(data);
                $("#modalVerEntregables").modal("show");
            });

            $(".verActa").click(function () {
                var folio = cedula.folio;
                var archivo = $(this).data("archivo");
                var tipo = $(this).data("tipo");
                var tipoArchivo = $(this).data("tipoarchivo");
                var guia = $(this).data("guia");
                var codigoRastreo = $(this).data("codigo");
                var tipoServicio = $(this).data("tiposervicio");
                var sobrepeso = $(this).data("sobrepeso");

                let url = '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?cAnio=' + @Model.Cedula.Anio+'&cMes=' + cedula.mes.nombre + '&cFolio=' + folio + '&tipoArchivo=' + tipoArchivo + '&cArchivo=' + archivo + '&tipo=' + tipo + '&handler=VisualizarActas';
                let data = '<object class="vistaPdf" embedded=True data="' + url + '"></object>';
                let detail = '<tr>' +
                    '<td><label>Año: </label> ' + cedula.anio + '</td>' +
                    '<td><label>Mes: </label> ' + cedula.mes.nombre + '</td>' +
                    '<td><label>Folio: </label> ' + folio + '</td>' +
                    '<td><label>Tipo de Incidencia: </label> ' + tipo + '</td>' +
                    '<td><label>Tipo de Archivo: </label> ' + tipoArchivo + '</td>' +
                    '</tr>';

                let detail2 = '<tr>' +
                    '<td><label>Número de Guía: </label> ' + guia + '</td>' +
                    '<td><label>Código de Rastreo: </label> ' + codigoRastreo + '</td>' +
                    '<td><label>Tipo de Servicio: </label> ' + tipoServicio + '</td>' +
                    '<td><label>Sobrepeso: </label> ' + sobrepeso + '</td>' +
                    '<td></td>' +
                    '</tr>';
                $("#titleVerEntregables").text("Vista del entregable - " + tipoArchivo);
                $('#detalleEntregable').html('<table class="table">' + detail + detail2 + '</table>');
                $('#objectPdf').html(data);
                $("#modalVerEntregables").modal("show");
            });

            $(".autorizarEntregable").click(function () {
                var formData = new FormData();

                formData.append("Id", $(this).data('id'));
                formData.append("CedulaEvaluacionId", cedula.id);
                formData.append("Estatus", "Autorizado");
                formData.append("EntregableId", $(this).data('entregableid'));
                formData.append("UsuarioId", usuario);

                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Autorizar</b> el entregable <b>' + $(this).data('tipo') + '</b>?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Autorizar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        formData.append("Observaciones", "Se autoriza el entregable.");
                        axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=AutorizarEntregables', formData, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => {
                            if (response.status == 200) {
                                Swal.fire({
                                    icon: "success",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "El entregable <b>" + $(this).data('tipo') + "</b> se autorizó correctamente.",
                                    confirmButtonText: 'Cerrar'
                                }).then(function () {
                                    Swal.fire({
                                        allowOutsideClick: false,
                                        icon: "info",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Actualizando la cédula de evaluación, espere por favor."
                                    });
                                    Swal.showLoading();
                                    window.location.reload();
                                });
                            }
                        }).catch(error => {
                            Swal.fire({
                                icon: "error",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                confirmButtonText: 'Cerrar'
                            });
                        });
                    }
                });
            });

            $(".rechazarEntregable").click(function () {
                var formData = new FormData();

                formData.append("Id", $(this).data('id'));
                formData.append("CedulaEvaluacionId", cedula.id);
                formData.append("Estatus", "Rechazado");
                formData.append("EntregableId", $(this).data('entregableid'));
                formData.append("UsuarioId", usuario);

                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Rechazar</b> el ' + $(this).data('tipo') + '?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Rechazar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            icon: 'info',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: 'Por favor captura el motivo por el cual se rechaza el(la) <b>' + $(this).data('tipo') + '</b>.',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            cancelButtonText: 'Cancelar',
                            confirmButtonText: 'Rechazar',
                            input: 'textarea',
                            inputPlaceholder: 'Escriba los comentarios correspondientes'
                        }).then(coments => {
                            if (coments.value.length > 0) {
                                formData.append("Observaciones", coments.value);
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=AutorizarEntregables', formData, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "El entregable <b>" + $(this).data('tipo') + "</b> se rechazó correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        });
                    }
                });
            });

            $(".validarEntregable").click(function () {
                var formData = new FormData();

                formData.append("Id", $(this).data('id'));
                formData.append("EstatusId", $(this).data('estatusid'));
                formData.append("Observaciones", "Se valida el entregable por la DAS.");
                formData.append("Validar", true);
                formData.append("Validado", true);

                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Estas seguro de que deseas <b>Validar</b> el ' + $(this).data('tipo') + '?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, validar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=validarEntregables', formData, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => {
                            if (response.status == 200) {
                                Swal.fire({
                                    icon: "success",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "El(la) " + $(this).data('tipo') + " se validó correctamente.",
                                    confirmButtonText: 'Cerrar'
                                }).then(function () {
                                    Swal.fire({
                                        allowOutsideClick: false,
                                        icon: "info",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Actualizando la cédula de evaluación, espere por favor."
                                    });
                                    Swal.showLoading();
                                    window.location.reload();
                                });
                            }
                        }).catch(error => {
                            Swal.fire({
                                icon: "error",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Hubo un error al validar el entregable. Contacte a su administrador del sistema.",
                                confirmButtonText: 'Cerrar'
                            });
                        });
                    }
                });
            });

            function formatMoney(number) {
                return number.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
            /*********************************** Apartado de Entregables **********************************/

            /*********************************** Guardado de la Cédula **********************************/
            $(".btnRegresar").click(function () {
                Swal.fire({
                    allowOutsideClick: false,
                    icon: "info",
                    title: 'Servicio de ' + servicio.descripcion,
                    html: "Regresando al listado de cédulas, espere por favor."
                });
                Swal.showLoading();
            });

            $(".guardarCedula").click(function () {
                var cRespuestas = new Array();

                for (var i = 0; i < respuestas.length; i++) {
                    let respuesta = $("input[name='" + respuestas[i].cuestionario.abreviacion + "']:checked").val();
                    if (respuesta != null && respuesta != undefined && respuesta != "N/A") {
                        cRespuestas.push({
                            CedulaEvaluacionId: parseInt(cedula.id), Pregunta: (i + 1),
                            Respuesta: (respuesta == "true"), UsuarioId: usuario
                        });
                    } else if (respuesta == "N/A") {
                        cRespuestas.push({
                            CedulaEvaluacionId: parseInt(cedula.id), Pregunta: (i + 1),
                            Respuesta: (respuesta == "true"), Detalles: respuesta, UsuarioId: usuario
                        });
                    }
                }

                $.ajax({
                    url: '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Html.Raw(Json.Serialize(Model.Cedula.InmuebleId))+'/' + @Html.Raw(Json.Serialize(Model.Cedula.Id))+'?handler=ActualizarRespuestas',
                    type: "put",
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(cRespuestas),
                    success: function () {
                        Swal.fire({
                            icon: 'success',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: 'Se guardaron las respuestas de la cédula de evaluación correctamente.',
                            confirmButtonText: 'Cerrar'
                        }).then(function () {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Guardando el cuestionario, espere por favor."
                            });
                            Swal.showLoading();
                            window.location.reload();
                        });
                    }
                });
            });

            $(".desbloquearC").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Desbloquear</b> la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Desbloquear',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "info",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "Desbloqueando la cédula de evaluación, espere por favor."
                        });
                        Swal.showLoading();
                        axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                            Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"), UsuarioId: usuario, RepositorioId: parseInt(repositorio),
                            EFacturaId: parseInt($(this).data('efacturaid')),
                            Observaciones: "Se desbloquea la cédula de evaluación.",
                            Flujo: supervision, Bloqueada: false, Elimina: true, Flujo: supervision
                        }).then(response => {
                            if (response.status == 200) {
                                Swal.fire({
                                    icon: "success",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "La cédula de evaluación fue desbloqueada correctamente.",
                                    confirmButtonText: 'Cerrar'
                                }).then(function () {
                                    window.location.reload();
                                });
                            }
                        }).catch(error => {
                            Swal.fire({
                                icon: "error",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Hubo un error al enviar la cédula. Contacte a su administrador del sistema.",
                                confirmButtonText: 'Cerrar'
                            });
                        });
                    }
                });
            });

            $(".enviarCedula").click(function () {
                if (validaCuestionario()) {
                    if (validaEntregables()) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: '¿Está seguro que desea <b>Enviar a DAS</b> la cédula de evaluación?',
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Si, Enviar',
                            cancelButtonText: 'Cancelar',
                            showCancelButton: true
                        }).then(confirm => {
                            if (confirm.isConfirmed) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Enviando la cédula de evaluación, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"), Calcula: true, UsuarioId: usuario,
                                    EFacturaId: parseInt($(this).data('efacturaid')),
                                    ENotaCreditoId: parseInt($(this).data('enotaid')),
                                    RepositorioId: parseInt(repositorio), Observaciones: "Se envía la cédula de evaluación a su revisión por la DAS.",
                                    Flujo: supervision,
                                    ServicioId: parseInt(modulo.servicioId),
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: (response.data.bloqueada == true ? "error" : "success"),
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: (response.data.bloqueada == true ?
                                                "La cédula de evaluación fue <b class='text-danger'>Bloqueada</b> debido a que aún existen guías pendientes de dar seguimiento." :
                                                "La cédula de evaluación fue enviada correctamente."
                                            ),
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al enviar la cédula. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        });
                    }
                } else {

                }
            });

            $(".generarCedula").click(function () {
                axios.get('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?inmueble=' + cedula.inmueble + '&handler=RevisarFirmantes').then(cedula => {
                    if (cedula.status == 200 && cedula.data != null) {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "info",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "Se generó la cédula de evaluación.",
                            confirmButtonText: 'Cerrar'
                        });
                        Swal.showLoading();
                        window.open('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/cedula/' + @Model.Repositorio.Id+'/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id, '_blank');
                        Swal.hideLoading();
                    }
                    else {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "error",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "<p style='text-align: justify'>Error no se puede generar la <b>Cédula de Evaluación</b>, favor de capturar previamente a los servidores públicos que firmarán electrónicamente la cédula de evaluación.</p>",
                            confirmButtonText: 'Capturar'
                        }).then(function () {
                            limpiaFirmantes()
                            $(".inmuebleReviso").val(inmueble.id);
                            $(".inmuebleSuperviso").val(inmueble.id);
                            $("#modal-firmante").modal("show");
                        });
                    }
                });
            });

            $("#actualizarFirmante").click(function () {
                var reviso = $("#firmanteReviso").val();
                var escolaridadR = $("#escolaridadReviso").val();
                var inmuebleR = $(".inmuebleReviso").val();
                var superviso = $("#firmanteSuperviso").val();
                var escolaridadS = $("#escolaridadSuperviso").val();
                var inmuebleS = $(".inmuebleSuperviso").val();

                Swal.fire({
                    allowOutsideClick: false,
                    icon: "info",
                    title: 'Servicio de ' + servicio.descripcion,
                    html: "Autorizando los firmantes, espere por favor."
                });
                Swal.showLoading();
                axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?Handler=CreateFirmante', {
                    InmuebleId: parseInt(inmuebleR), UsuarioId: reviso, Escolaridad: escolaridadR, Tipo: "Reviso"
                }).then(response => {
                    if (response.status && response.data != null) {
                        axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?Handler=CreateFirmante', {
                            InmuebleId: parseInt(inmuebleS), UsuarioId: superviso, Escolaridad: escolaridadS, Tipo: "Superviso"
                        }).then(response => {
                            if (response.status && response.data != null) {
                                Swal.fire({
                                    'icon': 'success',
                                    'title': servicio.descripcion,
                                    'html': '<p class="text-justify">Los firmantes se guardaron correctamente. Por favor, nuevamente intente generar su entregable.',
                                    confirmButtonText: 'Cerrar'
                                }).then(function () {
                                    $("#modal-firmante").modal("hide");
                                });
                            }
                        }).catch(error => {
                            Swal.fire({
                                'icon': 'error',
                                title: 'Servicio de ' + servicio.descripcion,
                                'html': 'Hubo un error al guardar al firmante que <b>Supervisa</b> el servicio. Contacte al administrador del sistema.'
                            });
                        });
                    }
                }).catch(error => {
                    Swal.fire({
                        'icon': 'error',
                        title: 'Servicio de ' + servicio.descripcion,
                        'html': 'Hubo un error al guardar al firmante que <b>Revisa</b> el servicio. Contacte al administrador del sistema.'
                    });
                });
            });

            $(".autorizar").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Autorizar</b> la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Autorizar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            icon: 'info',
                            title: 'Servicio de ' + servicio.descripcion,
                            text: 'Por favor capture los comentarios.',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            cancelButtonText: 'Cancelar',
                            confirmButtonText: 'Autorizar',
                            input: 'textarea',
                            inputPlaceholder: 'Escriba los comentarios correspondientes'
                        }).then(coments => {
                            if (coments.value.length > 0) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Autorizando la cédula de evaluación, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"), UsuarioId: usuario,
                                    EFacturaId: parseInt($(this).data('efacturaid')),
                                    ENotaCreditoId: parseInt($(this).data('enotaid')),
                                    RepositorioId: parseInt(repositorio),
                                    ServicioId: parseInt(modulo.servicioId),
                                    Observaciones: coments.value,
                                    Flujo: supervision
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "La cédula de evaluación se autorizó correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        })
                    }
                });
            });

            $(".rechazar").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Rechazar</b> la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Rechazar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            icon: 'info',
                            title: 'Servicio de ' + servicio.descripcion,
                            text: 'Por favor capture el motivo por el cual rechaza la cédula.',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            cancelButtonText: 'Cancelar',
                            confirmButtonText: 'Rechazar',
                            input: 'textarea',
                            inputPlaceholder: 'Escriba los comentarios correspondientes'
                        }).then(coments => {
                            if (coments.value.length > 0) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Rechazando la cédula de evaluación, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id),
                                    EstatusId: $(this).data("estatusid"),
                                    Observaciones: coments.value,
                                    EFacturaId: parseInt($(this).data('efacturaid')),
                                    ENotaCreditoId: parseInt($(this).data('enotaid')),
                                    RepositorioId: parseInt(repositorio),
                                    ServicioId: parseInt(modulo.servicioId),
                                    Mes: cedula.mes.nombre,
                                    UsuarioId: usuario,
                                    Flujo: supervision,
                                    Elimina: $(this).data('elimina')
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "La cédula de evaluación se rechazó correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        })
                    }
                });
            });

            $(".revisarCAE").click(function () {
                if (!validaNC()) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: 'La cédula cuenta con deductivas y aún no se adjunta la <b>Nota de Crédito</b>, favor de contactar a la <b>DAS</b>.',
                        confirmButtonText: 'Cerrar'
                    });

                    return false;
                }

                if (validaEntregables()) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: '¿Está seguro que desea <b>Enviar a revisión por la CAE</b> la cédula de evaluación?',
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Si, enviar',
                        cancelButtonText: 'Cancelar',
                        showCancelButton: true
                    }).then(confirm => {
                        if (confirm.isConfirmed) {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Enviando la cédula de evaluación a revisión CAE, espere por favor."
                            });
                            Swal.showLoading();
                            axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"),
                                UsuarioId: usuario,
                                RepositorioId: parseInt(repositorio),
                                EFacturaId: parseInt($(this).data('efacturaid')),
                                ENotaCreditoId: parseInt($(this).data('enotaid')),
                                ServicioId: parseInt(modulo.servicioId),
                                Observaciones: "Se envía la cédula a revisión por parte de la CAE.",
                                Flujo: supervision
                            }).then(response => {
                                if (response.status == 200) {
                                    Swal.fire({
                                        icon: "success",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "La cédula de evaluación se envió a revisión de la CAE correctamente.",
                                        confirmButtonText: 'Cerrar'
                                    }).then(function () {
                                        Swal.fire({
                                            allowOutsideClick: false,
                                            icon: "info",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "Actualizando la cédula de evaluación, espere por favor."
                                        });
                                        Swal.showLoading();
                                        window.location.reload();
                                    });
                                }
                            }).catch(error => {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                    confirmButtonText: 'Cerrar'
                                });
                            });
                        }
                    });
                }
            });

            $(".autorizarCAE").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Autorizar por la CAE</b> la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, autorizar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "info",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "Verificando la cédula de evaluación, espere por favor."
                        });
                        Swal.showLoading();
                        axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=AutorizarCAE', {
                            Id: parseInt(cedula.id)
                        }).then(confirm => {
                            if (confirm.data == 0) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Autorizando la cédula de evaluación por la CAE, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"),
                                    UsuarioId: usuario,
                                    RepositorioId: parseInt(repositorio),
                                    EFacturaId: parseInt($(this).data('efacturaid')),
                                    ENotaCreditoId: parseInt($(this).data('enotaid')),
                                    ServicioId: parseInt(modulo.servicioId),
                                    Observaciones: "Se autoriza la cédula por parte de la CAE.",
                                    Flujo: supervision
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "La cédula de evaluación se autorizó por la CAE correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                });
                            }
                            else {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Existen entregables pendientes de autorizar o rechazar. Favor de revisar.",
                                    confirmButtonText: 'Cerrar'
                                });
                            }
                        });
                    }
                });
            });

            $(".tramiteRechazado").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Rechazar el trámite</b> de la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, Rechazar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "info",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "Verificando la cédula de evaluación, espere por favor."
                        });
                        Swal.showLoading();
                        axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=TramiteRechazado', {
                            Id: parseInt(cedula.id)
                        }).then(confirm => {
                            if (confirm.data == 0) {
                                Swal.fire({
                                    icon: 'info',
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: 'Por favor capture el motivo por el cual <b>Rechaza el trámite</b> de la cédula.',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    cancelButtonText: 'Cancelar',
                                    confirmButtonText: 'Rechazar',
                                    input: 'textarea',
                                    inputPlaceholder: 'Escriba los comentarios correspondientes'
                                }).then(coments => {
                                    if (coments.value.length > 0) {
                                        Swal.fire({
                                            allowOutsideClick: false,
                                            icon: "info",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "Rechazando el trámite de la cédula de evaluación, espere por favor."
                                        });
                                        Swal.showLoading();
                                        axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                            Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"),
                                            EFacturaId: parseInt($(this).data('efacturaid')),
                                            ENotaCreditoId: parseInt($(this).data('enotaid')),
                                            UsuarioId: usuario,
                                            RepositorioId: parseInt(repositorio),
                                            ServicioId: parseInt(modulo.servicioId),
                                            Observaciones: coments.value,
                                            Elimina: $(this).data('elimina'),
                                            Flujo: supervision
                                        }).then(response => {
                                            if (response.status == 200) {
                                                Swal.fire({
                                                    icon: "success",
                                                    title: 'Servicio de ' + servicio.descripcion,
                                                    html: "El trámite de la cédula de evaluación se rechazó correctamente.",
                                                    confirmButtonText: 'Cerrar'
                                                }).then(function () {
                                                    Swal.fire({
                                                        allowOutsideClick: false,
                                                        icon: "info",
                                                        title: 'Servicio de ' + servicio.descripcion,
                                                        html: "Actualizando la cédula de evaluación, espere por favor."
                                                    });
                                                    Swal.showLoading();
                                                    window.location.reload();
                                                });
                                            }
                                        }).catch(error => {
                                            Swal.fire({
                                                icon: "error",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                                confirmButtonText: 'Cerrar'
                                            });
                                        });
                                    }
                                })
                            }
                            else {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Existen entregables pendientes de autorizar o rechazar. Favor de revisar.",
                                    confirmButtonText: 'Cerrar'
                                });
                            }
                        });
                    }
                });
            });

            $(".tramitar").click(function () {
                if (!validaNC()) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: 'La cédula cuenta con deductivas y aún no se adjunta la <b>Nota de Crédito</b>, favor de contactar a la <b>DAS</b>.',
                        confirmButtonText: 'Cerrar'
                    });

                    return false;
                }

                if (validaEntregables()) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: '¿Está seguro que desea <b>Tramitar</b> la cédula de evaluación?',
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Si, tramitar',
                        cancelButtonText: 'Cancelar',
                        showCancelButton: true
                    }).then(confirm => {
                        if (confirm.isConfirmed) {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Tramitando la cédula de evaluación, espere por favor."
                            });
                            Swal.showLoading();
                            axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"),
                                EFacturaId: parseInt($(this).data('efacturaid')),
                                ENotaCreditoId: parseInt($(this).data('enotaid')),
                                UsuarioId: usuario,
                                RepositorioId: parseInt(repositorio),
                                ServicioId: parseInt(modulo.servicioId),
                                Observaciones: "Se tramita la cédula por parte de la administración.",
                                Flujo: supervision
                            }).then(response => {
                                if (response.status == 200) {
                                    Swal.fire({
                                        icon: "success",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "La cédula de evaluación se tramitó correctamente.",
                                        confirmButtonText: 'Cerrar'
                                    }).then(function () {
                                        Swal.fire({
                                            allowOutsideClick: false,
                                            icon: "info",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "Actualizando la cédula de evaluación, espere por favor."
                                        });
                                        Swal.showLoading();
                                        window.location.reload();
                                    });
                                }
                            });
                        }
                    });
                }
            });

            $(".tramitePago").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Tramitar a Pago</b> la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, tramitar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        axios.post('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=TramitarPago', {
                            Id: parseInt(cedula.id)
                        }).then(confirm => {
                            if (confirm.data == 200) {
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id), EstatusId: $(this).data("estatusid"),
                                    EFacturaId: parseInt($(this).data('efacturaid')),
                                    ENotaCreditoId: parseInt($(this).data('enotaid')),
                                    UsuarioId: usuario,
                                    RepositorioId: parseInt(repositorio),
                                    ServicioId: parseInt(modulo.servicioId),
                                    Observaciones: "Se envió a trámite de pago la cédula de evaluación.",
                                    Flujo: supervision
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "La cédula de evaluación se tramitó a pago correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                });
                            }
                            else if (confirm.data == 206) {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Existen entregables pendientes. Favor de revisar.",
                                    confirmButtonText: 'Cerrar'
                                });
                            }
                            else if (confirm.data == 207) {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "<p style='text-align: justify'>Verifique que ya fueron validados los siguientes entregables:<br />" +
                                        "- <b>Memorándum</b><br>" +
                                        "- <b>Acta Entrega - Recepción (Firmada)</b><br>" +
                                        "- <b>Cédula Firmada (FIREL)</b>.<br></p>",
                                    confirmButtonText: 'Cerrar'
                                });
                            }
                            else {
                                Swal.fire({
                                    icon: "error",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Aún no se válida el <b>Acuse Memorándum (Firel)</b>.",
                                    confirmButtonText: 'Cerrar'
                                });
                            }
                        });
                    }
                });
            });

            function limpiaFirmantes() {
                $("#firmanteReviso").val('');
                $("#escolaridadReviso").val('');
                $(".inmuebleReviso").val('');
                $("#firmanteSuperviso").val('');
                $("#escolaridadSuperviso").val('');
                $(".inmuebleSuperviso").val('');
            }

            function validaCuestionario() {
                var complete = false;
                var preguntas = "";
                for (var i = 0; i < respuestas.length; i++) {
                    let respuesta = $("input[name='" + respuestas[i].cuestionario.abreviacion + "']:checked").val();
                    if (respuesta != null && respuesta != undefined) {
                        if (respuestas[i].ciComedor.respuesta + "" == respuesta && respuestas[i].ciComedor.obligatorio + "" == "true") {
                            if (cuentaIncidencias(cedula.id, respuestas[i].pregunta) == 0) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: 'Debe registrar la(s) incidencia(s) correspondientes en la <b>Pregunta ' + (i + 1) + '</b>',
                                    confirmButtonText: 'Cerrar'
                                });
                                return false;
                            }
                        }
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: 'Debe contestar la <b>Pregunta ' + (i + 1) + '</b>',
                            confirmButtonText: 'Cerrar'
                        });

                        return false;
                    }
                }

                for (var i = 0; i < respuestas.length; i++) {
                    let respuesta = $("input[name='" + respuestas[i].cuestionario.abreviacion + "']:checked").val();

                    if (respuestas[i].respuesta + "" != respuesta + "" && respuesta != "N/A" && respuesta != "N/R" && respuesta != "N/E") {
                        Swal.fire({
                            icon: 'error',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: 'Debe guardar el cuestionario antes de enviar a revisión por la DAS.',
                            confirmButtonText: 'Cerrar'
                        });
                        return false;
                    }
                }
                return true;
            }

            function cuentaIncidencias(cedula, pregunta) {
                var isContinue = true;
                $.ajax({
                    url: '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?Cedula=' + cedula + '&Pregunta=' + pregunta + '&handler=Incidencias',
                    type: 'GET',
                    async: false,
                    success: function (json) {
                        json == 0 ? isContinue = false : true;
                    },
                });
                return isContinue;
            }

            function validaEntregables() {
                var e = "";
                for (var i = 0; i < entregables.length; i++) {
                    if (entregables[i].archivo == null || entregables[i].archivo == "" || entregables[i].estatus.nombre == "Rechazado") {
                        e += "<b>- " + entregables[i].tipoEntregable.nombre + "</b><br>";
                    }
                }

                if (e != "") {
                    Swal.fire({
                        icon: 'error',
                        title: 'Servicio de ' + servicio.descripcion,
                        html: 'Se deben adjuntar los siguientes entregables: <br>' + e,
                        confirmButtonText: 'Cerrar'
                    });

                    return false;
                }
                else {
                    return true;
                }
            }

            function validaNC() {
                if (penasDeductivas != 0 && existsNC != 0) {
                    return true;

                }
                else if (penasDeductivas != 0 && existsNC == 0) {
                    return false;
                }
                else if (penasDeductivas == 0) {
                    return true;
                }
            }

            function guardarCedula() {
                var cRespuestas = new Array();

                for (var i = 0; i < respuestas.length; i++) {
                    let respuesta = $("input[name='" + respuestas[i].cuestionario.abreviacion + "']:checked").val();
                    if (respuesta != null && respuesta != undefined && (respuesta != "N/A" && respuesta != "N/E" && respuesta != "N/R")) {
                        cRespuestas.push({
                            CedulaEvaluacionId: parseInt(cedula.id), Pregunta: (i + 1),
                            Respuesta: (respuesta == "true"), UsuarioId: usuario
                        });
                    } else if (respuesta == "N/A" || respuesta == "N/E" || respuesta == "N/R") {
                        cRespuestas.push({
                            CedulaEvaluacionId: parseInt(cedula.id), Pregunta: (i + 1),
                            Respuesta: (respuesta == "true"), Detalles: respuesta, UsuarioId: usuario
                        });
                    }
                }

                $.ajax({
                    url: '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Html.Raw(Json.Serialize(Model.Cedula.InmuebleId))+'/' + @Html.Raw(Json.Serialize(Model.Cedula.Id))+'?handler=ActualizarRespuestas',
                    type: "put",
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(cRespuestas),
                    success: function () {
                        Swal.fire({
                            icon: 'success',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: 'Se guardaron las respuestas de la cédula de evaluación correctamente.',
                            confirmButtonText: 'Cerrar'
                        }).then(function () {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Actualizando el cuestionario, espere por favor."
                            });
                            Swal.showLoading();
                            window.location.reload();
                        });
                    }
                });
            }

            function guardarCedulaCP(obligatorio, pregunta, respuesta) {
                var cRespuestas = new Array();

                for (var i = 0; i < respuestas.length; i++) {
                    let respuesta = $("input[name='" + respuestas[i].cuestionario.abreviacion + "']:checked").val();
                    if (respuesta != null && respuesta != undefined && (respuesta != "N/A" && respuesta != "N/E" && respuesta != "N/R")) {
                        cRespuestas.push({
                            CedulaEvaluacionId: parseInt(cedula.id), Pregunta: (i + 1),
                            Respuesta: (respuesta == "true"), UsuarioId: usuario
                        });
                    } else if (respuesta == "N/A" || respuesta == "N/E" || respuesta == "N/R") {
                        cRespuestas.push({
                            CedulaEvaluacionId: parseInt(cedula.id), Pregunta: (i + 1),
                            Respuesta: (respuesta == "true"), Detalles: respuesta, UsuarioId: usuario
                        });
                    }
                }

                $.ajax({
                    url: '/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Html.Raw(Json.Serialize(Model.Cedula.InmuebleId))+'/' + @Html.Raw(Json.Serialize(Model.Cedula.Id))+'?handler=ActualizarRespuestas',
                    type: "put",
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(cRespuestas),
                    success: function () {
                        if (obligatorio && respuesta != "N/A") {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "warning",
                                'title': servicio.descripcion,
                                html: "La <b>Pregunta " + pregunta + " requiere</b> captura de incidencias.",
                                confirmButtonText: 'Cerrar'
                            }).then(function () {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Cargando información para la captura de incidencias, espere por favor."
                                });
                                Swal.showLoading();
                                window.location.reload();
                            });
                        }
                        else {
                            Swal.fire({
                                allowOutsideClick: false,
                                icon: "info",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "Guardando información, espere por favor."
                            });
                            Swal.showLoading();
                            window.location.reload();
                        }
                    }
                });
            }

            $(".generaAER").click(function () {
                axios.get('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?inmueble=' + cedula.inmueble + '&handler=RevisarFirmantes').then(cedula => {
                    if (cedula.status == 200 && cedula.data != null) {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "info",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "Generando el <b>Acta Entrega - Recepción</b> de la evaluación, espere por favor."
                        });
                        Swal.showLoading();
                        if (penasDeductivas == 0 || existsNC != 0) {
                            axios.get('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?nFacturacion=' + @Model.Repositorio.Id+'&CedulaId=' + @Model.Cedula.Id+'&nInmueble=' + @Model.Inmueble.Id+'&Supervision=' + supervision + '&Handler=ActaEntregaRecepcion', { responseType: 'blob' }).then(response => {
                                if (response.status == 200) {
                                    const href = URL.createObjectURL(response.data);
                                    const link = document.createElement('a');
                                    link.href = href;
                                    link.setAttribute('download', 'Acta_Entrega_Recepcion_Comedor_Recepcion.docx');
                                    document.body.appendChild(link);
                                    link.click();
                                    document.body.removeChild(link);
                                    URL.revokeObjectURL(href);
                                    Swal.fire({
                                        allowOutsideClick: false,
                                        icon: "info",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "El <b>Acta Entrega - Recepción</b> se descargó correctamente. <p class='text-justify mt-3'>" +
                                            "<b class='text-danger'>Sugerencia:</b> En caso de que se generé una hoja en blanco favor de eliminarla.</p>",
                                        confirmButtonText: 'Cerrar'
                                    });
                                    Swal.hideLoading();
                                }
                            });
                        }
                        else {
                            Swal.fire({
                                icon: "error",
                                title: 'Servicio de ' + servicio.descripcion,
                                html: "No es posible generar el <b>Acta Entrega - Recepción</b> ya que aún no se adjunta el XML de la <b>Nota de Crédito</b>.",
                                confirmButtonText: 'Cerrar'
                            });
                        }
                    }
                    else {
                        Swal.fire({
                            allowOutsideClick: false,
                            icon: "error",
                            title: 'Servicio de ' + servicio.descripcion,
                            html: "<p style='text-align: justify'>Error no se puede generar el <b>Acta Entrega - Recepción</b>, favor de capturar previamente a los servidores públicos que firmarán electrónicamente la cédula de evaluación.</p>",
                            confirmButtonText: 'Capturar'
                        }).then(function () {
                            limpiaFirmantes()
                            $(".inmuebleReviso").val(inmueble.id);
                            $(".inmuebleSuperviso").val(inmueble.id);
                            $("#modal-firmante").modal("show");
                        });
                    }
                });
            });

            $(".btnAyuda").click(function () {
                var msg = $(this).data("ayuda");
                Swal.fire({
                    'customClass': 'swal-wide',
                    'icon': "info",
                    'title': servicio.descripcion,
                    'confirmButtonText': 'Cerrar',
                    'html': msg
                });
            });

            $(".btnAyudaI").click(function () {
                var msg = $(this).data("ayuda");
                if (msg != "") {
                    Swal.fire({
                        'customClass': 'swal-wide',
                        'icon': "info",
                        'title': servicio.descripcion,
                        'confirmButtonText': 'Cerrar',
                        'html': msg
                    });
                } else {
                    $(this).css("display", "none");
                }
            });

            $(".solicitudRechazo").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Soliciar el Rechazo</b> de la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, continuar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            icon: 'info',
                            title: 'Servicio de ' + servicio.descripcion,
                            html: '<p style = "text-align: justify">Por favor capture el motivo por el cual solicita el rechazo de la cédula. <br/><br/>' +
                                '<b class= "text-danger" >Advertencia: </b> En caso de que se autorice el <b>Rechazo de la cédula</b> todos los entregables ' +
                                'a <b>excepción de la "Factura" y la "Validación del SAT"</b> serán eliminados.<br/><br/>' +
                                '<b class= "text-danger" >Una vez eliminados los entregables no se podrán recuperar. </b></p>',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            cancelButtonText: 'Cancelar',
                            confirmButtonText: 'Solicitar rechazo',
                            input: 'textarea',
                            inputPlaceholder: 'Escriba los comentarios correspondientes'
                        }).then(coments => {
                            if (coments.value.length > 0) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Solicitando el rechazo de la cédula de evaluación, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id),
                                    UsuarioId: usuario,
                                    EstatusId: 14,
                                    Estatus: "En Revisión",
                                    Bloqueada: true,
                                    Aprobada: true,
                                    Flujo: supervision,
                                    ServicioId: parseInt(modulo.servicioId),
                                    Observaciones: coments.value,
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "Se envió la solicitud del rechazó correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        })
                    }
                });
            });

            $(".denegarRechazo").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Denegar el Rechazo</b> de la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, continuar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            icon: 'info',
                            title: 'Servicio de ' + servicio.descripcion,
                            text: 'Por favor capture el motivo por el cual solicita el deniega el rechazo de la cédula.',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            cancelButtonText: 'Cancelar',
                            confirmButtonText: 'Denegar rechazo',
                            input: 'textarea',
                            inputPlaceholder: 'Escriba los comentarios correspondientes'
                        }).then(coments => {
                            if (coments.value.length > 0) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Denegando el rechazo de la cédula de evaluación, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=UpdateCedula', {
                                    Id: parseInt(cedula.id),
                                    UsuarioId: usuario,
                                    EstatusId: @Model.RevertirEstatus,
                                    Bloqueada: false,
                                    Aprobada: false,
                                    Flujo: supervision,
                                    Observaciones: coments.value,
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "Se denegó la solicitud del rechazó correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al autorizar la cédula de evaluación. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        })
                    }
                });
            });

            $(".cancelarRechazo").click(function () {
                Swal.fire({
                    icon: 'warning',
                    title: 'Servicio de ' + servicio.descripcion,
                    html: '¿Está seguro que desea <b>Cancelar el Rechazo</b> de la cédula de evaluación?',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, cancelar',
                    cancelButtonText: 'Cancelar',
                    showCancelButton: true
                }).then(confirm => {
                    if (confirm.isConfirmed) {
                        Swal.fire({
                            icon: 'info',
                            title: 'Servicio de ' + servicio.descripcion,
                            text: 'Por favor capture el motivo por el cual cancela el rechazo de la cédula.',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            cancelButtonText: 'Cancelar',
                            confirmButtonText: 'Cancelar rechazo',
                            input: 'textarea',
                            inputPlaceholder: 'Escriba los comentarios correspondientes'
                        }).then(coments => {
                            if (coments.value.length > 0) {
                                Swal.fire({
                                    allowOutsideClick: false,
                                    icon: "info",
                                    title: 'Servicio de ' + servicio.descripcion,
                                    html: "Cancelando la solicitud de rechazo de la cédula de evaluación, espere por favor."
                                });
                                Swal.showLoading();
                                axios.put('/comedor/' + @Model.Modulo.Id+'/' + @Model.Submodulo.Id+'/detalle/' + @Model.Inmueble.Id+'/' + @Model.Cedula.Id+'?handler=DenegarSolicitudRechazo', {
                                    Id: parseInt(cedula.id),
                                    UsuarioId: usuario,
                                    EstatusId: @Model.RevertirEstatus,
                                    Bloqueada: false,
                                    Aprobada: false,
                                    ServicioId: parseInt(modulo.servicioId),
                                    Observaciones: coments.value,
                                }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            icon: "success",
                                            title: 'Servicio de ' + servicio.descripcion,
                                            html: "Se canceló la solicitud del rechazo correctamente.",
                                            confirmButtonText: 'Cerrar'
                                        }).then(function () {
                                            Swal.fire({
                                                allowOutsideClick: false,
                                                icon: "info",
                                                title: 'Servicio de ' + servicio.descripcion,
                                                html: "Actualizando la cédula de evaluación, espere por favor."
                                            });
                                            Swal.showLoading();
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        icon: "error",
                                        title: 'Servicio de ' + servicio.descripcion,
                                        html: "Hubo un error al cancelar la solicitud de la cédula de evaluación. Contacte a su administrador del sistema.",
                                        confirmButtonText: 'Cerrar'
                                    });
                                });
                            }
                        })
                    }
                });
            });

            /*********************************** Guardado de la Cédula **********************************/
        });
    </script>
}
